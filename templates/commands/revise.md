---
description: 系统性修改润色：四层修改流程（结构→节奏→一致性→文字），支持分层修改、指定范围、快速模式
argument-hint: [--layer=structure|pacing|consistency|polish] [--chapters=1-10] [--chapter=5] [--quick]
allowed-tools: Bash(find:*), Bash(wc:*), Bash(grep:*), Read(//**), Write(//stories/**), Bash(*)
model: claude-sonnet-4-5-20250929
---

对已完成的初稿进行系统性修改润色。从结构到文字的四层修改流程，将 `/analyze` 的诊断转化为具体可执行的修改方案。

---

## 核心理念

**诊断之后是治疗**：
- 🔍 `/analyze` = 诊断（发现问题）
- 🔧 `/revise` = 治疗（解决问题）

**从大到小，分层修改**：
- 先结构，再节奏，再一致性，最后文字
- 不在结构未定时打磨文字

---

## 执行流程

### 1. 解析参数

解析用户参数 `$ARGUMENTS`：

**分层模式**（指定修改层）：
- `--layer=structure` → 仅结构修改
- `--layer=pacing` → 仅节奏修改
- `--layer=consistency` → 仅一致性修改
- `--layer=polish` → 仅文字润色

**范围模式**（指定章节范围）：
- `--chapters=1-10` → 修改第 1-10 章
- `--chapter=5` → 修改第 5 章

**快速模式**：
- `--quick` → 跳过结构和节奏，直接做一致性 + 文字润色

**默认模式**（无参数）：
- 完整四层修改流程

### 2. 加载上下文

**必须加载**：
- 所有已完成章节：`stories/*/content/*.md` 或 `stories/*/chapters/*.md`
- 故事规格：`stories/*/specification.md`
- 创作计划：`stories/*/creative-plan.md`
- 角色状态：`spec/tracking/character-state.json`
- 关系网络：`spec/tracking/relationships.json`

**如有则加载**：
- `/analyze` 报告：`stories/*/analysis-report.md`
- 风格参考：`.specify/memory/style-reference.md`
- 个人风格：`.specify/memory/personal-voice.md`
- 情节追踪：`spec/tracking/plot-tracker.json`

**加载 Skill**：
- `.specify/templates/skills/writing-techniques/revision-polish/SKILL.md`（核心修改流程）

### 3. 初稿评估

**如果是完整修改（无 --layer 参数）**，先生成初稿评估报告：

```markdown
## 初稿评估报告

### 基本信息
- 总章数：[X] 章
- 总字数：[X] 字
- 平均章节长度：[X] 字

### 各层问题预估
| 层次 | 问题严重度 | 预估问题数 | 是否需要修改 |
|------|-----------|-----------|-------------|
| 结构 | [严重度] | [X] 处 | [是/否] |
| 节奏 | [严重度] | [X] 处 | [是/否] |
| 一致性 | [严重度] | [X] 处 | [是/否] |
| 文字 | [严重度] | [X] 处 | [是/否] |

### 建议修改策略
[根据评估结果给出建议]
```

### 4. 执行修改

根据参数和评估结果，按 SKILL.md 中定义的四层模型执行修改。

**每层修改的输出格式**：

#### Layer 1: 结构修改

```markdown
## 结构审查报告

### 结构问题
| 严重度 | 位置 | 问题描述 | 操作建议 |
|--------|------|---------|---------|
| [级别] | [章节] | [描述] | [具体操作] |

### 操作清单
1. □ [具体操作1]
2. □ [具体操作2]

是否执行以上修改？ [Y/N/S(选择性)]
```

#### Layer 2: 节奏修改

```markdown
## 节奏审查报告

### 节奏曲线
[ASCII 节奏可视化]

### 节奏问题
| 严重度 | 位置 | 问题描述 | 操作建议 |
|--------|------|---------|---------|
| [级别] | [章节] | [描述] | [具体操作] |

### 操作清单
[具体操作列表]

是否执行以上修改？ [Y/N/S(选择性)]
```

#### Layer 3: 一致性修改

```markdown
## 一致性审查报告

### 角色一致性
[角色矛盾列表]

### 时间线一致性
[时间线矛盾列表]

### 伏笔回收
[伏笔状态表]

### 操作清单
[具体操作列表]

是否执行以上修改？ [Y/N/S(选择性)]
```

#### Layer 4: 文字润色

```markdown
## 文字润色报告

### 全局统计
[高频问题统计]

### 逐章润色建议
[每章的具体修改建议]

是否执行以上修改？ [Y/N/S(选择性)]
```

### 5. 用户确认

**每层修改都需要用户确认**：
- **[Y]** 全部执行 - 应用该层所有修改建议
- **[N]** 跳过 - 不执行该层修改，进入下一层
- **[S]** 选择性执行 - 逐项确认每个修改

### 6. 执行修改

用户确认后，直接修改章节文件：
- 读取原始章节文件
- 应用确认的修改
- 写入修改后的文件
- 保留原始文件备份（如用户要求）

### 7. 最终检查

所有层修改完成后，运行修改完成检查清单：

```markdown
## 修改完成检查清单

### 结构层
- [x/□] 无多余章节
- [x/□] 无缺失关键场景
- [x/□] 高潮位置合理

### 节奏层
- [x/□] 无连续 3 章以上节奏停滞
- [x/□] 紧张/舒缓交替合理
- [x/□] 每章结尾有钩子

### 一致性层
- [x/□] 角色性格前后一致
- [x/□] 时间线无矛盾
- [x/□] 伏笔回收率 > 90%

### 文字层
- [x/□] 无高频重复词
- [x/□] 无明显 AI 痕迹
- [x/□] 符合个人风格指南

---
✅ 全部通过 → 修改完成，可以执行 /export 导出
⚠️ 部分未通过 → 建议再次运行 /revise 针对性修改
```

---

## 使用场景

### 场景 1：完整修改流程

```bash
用户：/revise
AI：正在评估初稿...

【初稿评估报告】
总章数：30 章，总字数：256,000 字

各层问题预估：
- 结构：⚠️ 中等（3 处）
- 节奏：🔴 严重（8 处）
- 一致性：⚠️ 中等（5 处）
- 文字：🟡 轻微（15 处）

开始 Layer 1: 结构修改...

【结构审查报告】
🔴 第 8-12 章节奏停滞，建议合并
🟡 第 1 章开头过长

是否执行？ [Y/N/S]

用户：Y

结构修改完成。进入 Layer 2: 节奏修改...
```

### 场景 2：仅文字润色

```bash
用户：/revise --layer polish
AI：跳过结构、节奏、一致性层，直接进入文字润色...

【文字润色报告】
🔴 "突然"出现 47 次
🔴 AI痕迹词 38 处
🟡 对话标签过多 12 处

逐章润色建议：
第 1 章：3 处修改建议
第 2 章：5 处修改建议
...

是否执行？ [Y/N/S]
```

### 场景 3：快速模式

```bash
用户：/revise --quick
AI：快速模式：跳过结构和节奏，执行一致性 + 文字润色...

Layer 3: 一致性修改...
Layer 4: 文字润色...
```

### 场景 4：指定范围

```bash
用户：/revise --chapters 1-10
AI：修改范围：第 1-10 章

注意：结构修改（Layer 1）建议全局审查。
是否仍然只修改第 1-10 章？ [Y/全局]

用户：Y

开始修改第 1-10 章...
```

### 场景 5：与 /analyze 联动

```bash
用户：/analyze
AI：【分析报告】发现 15 个问题...

用户：/revise
AI：检测到 /analyze 报告，自动映射问题到修改层：
- 结构问题 3 个 → Layer 1
- 节奏问题 5 个 → Layer 2
- 一致性问题 4 个 → Layer 3
- 文字问题 3 个 → Layer 4

开始按层修改...
```

---

## 与其他命令的关系

```text
/analyze → 诊断问题
    ↓
/revise → 系统修改（本命令）
    ↓
/analyze → 复查验证
    ↓
/export → 导出成品
```

**互补关系**：
- `/analyze` 发现问题，`/revise` 解决问题
- `/analyze --focus=style` 诊断风格，`/revise --layer polish` 修改文字
- `/analyze --focus=logic` 诊断逻辑，`/revise --layer consistency` 修复一致性

---

## 注意事项

### 修改原则
- **保守修改**：能不改就不改，只改真正有问题的
- **保持风格**：修改时保持作者个人风格
- **用户确认**：每层修改都需要用户确认后才执行
- **可回退**：建议用户在修改前 git commit 保存当前版本

### 修改终点
- 建议最多 2-3 轮修改
- 第 1 轮：结构 + 节奏（大改）
- 第 2 轮：一致性 + 文字（精修）
- 第 3 轮（可选）：针对性微调
- 3 轮后仍不满意 → 问题可能在初稿设计，建议回到 `/plan`

### 性能考虑
- 完整修改需要读取所有章节，token 消耗较大
- 建议分批修改：先 `--chapters 1-15`，再 `--chapters 16-30`
- 文字润色（Layer 4）消耗最大，可按章节分批执行

---

## 🔗 命令链式提示

**命令执行完成后，自动附加下一步建议**：

```
💡 下一步建议：
1️⃣ `/analyze` — 复查验证修改效果
2️⃣ `/write [下一章节号]` — 修改完成后继续写作
3️⃣ `/revise --layer polish` — 如需进一步文字润色
```
