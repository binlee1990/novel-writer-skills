---
name: timeline
description: ç®¡ç†å’ŒéªŒè¯æ•…äº‹æ—¶é—´çº¿
argument-hint: [add | check | show | sync] [--volume vol-XX | --recent N]
allowed-tools: Read(//spec/tracking/timeline.json), Read(//spec/tracking/timeline.json), Write(//spec/tracking/timeline.json), Write(//spec/tracking/timeline.json), Read(//stories/**/content/**), Read(//stories/**/content/**), Bash(find:*), Bash(*)
scripts:
  sh: .specify/scripts/bash/check-timeline.sh
  ps: .specify/scripts/powershell/check-timeline.ps1
---

# æ—¶é—´çº¿ç®¡ç†

ç»´æŠ¤æ•…äº‹çš„æ—¶é—´è½´ï¼Œç¡®ä¿æ—¶é—´é€»è¾‘çš„ä¸€è‡´æ€§ã€‚

## èµ„æºåŠ è½½ï¼ˆå¯é€‰ï¼‰

æœ¬å‘½ä»¤ç”¨äºç®¡ç†æ•…äº‹æ—¶é—´çº¿ï¼Œé»˜è®¤è¯»å– `tracking/timeline.json`ã€‚

### å¯é€‰é…ç½®

```yaml
resource-loading:
  timeline:
    knowledge-base:
      craft:
        - pacing  # æ—¶é—´èŠ‚å¥æ§åˆ¶
    skills:
      quality-assurance:
        - consistency-checker  # æ—¶é—´çº¿ä¸€è‡´æ€§æ£€æŸ¥
```

**æ¨èèµ„æº**: pacing.mdï¼ˆæ—¶é—´èŠ‚å¥æ§åˆ¶ï¼‰

## æ•°æ®åŠ è½½ç­–ç•¥

æœ¬å‘½ä»¤é‡‡ç”¨ **ä¸‰å±‚å›é€€** æœºåˆ¶åŠ è½½æ—¶é—´çº¿æ•°æ®ï¼š

### Layer 3: MCP æŸ¥è¯¢ï¼ˆä¼˜å…ˆï¼‰

```typescript
// å¦‚æœ MCP å·²å¯ç”¨ä¸”æ•°æ®å·²åŒæ­¥
const events = await mcp.call('novelws-mcp/query_timeline', {
  volume: 'vol-03',     // --volume å‚æ•°
  limit: 50             // --recent å‚æ•°
});
```

**ä¼˜åŠ¿**ï¼š
- é«˜æ€§èƒ½èŒƒå›´æŸ¥è¯¢ï¼ˆvolume/æ—¶é—´èŒƒå›´è¿‡æ»¤ï¼‰
- æ”¯æŒ FTS5 å…¨æ–‡æœç´¢äº‹ä»¶æè¿°
- è‡ªåŠ¨èšåˆç»Ÿè®¡ï¼ˆæ—¶é—´è·¨åº¦ã€äº‹ä»¶å¯†åº¦ï¼‰

### Layer 2: åˆ†ç‰‡ JSONï¼ˆæ¬¡ä¼˜ï¼‰

```bash
# å½“ spec/tracking/volumes/ å­˜åœ¨æ—¶
timeline_data=$(cat spec/tracking/volumes/vol-03/timeline.json)
```

**é€‚ç”¨åœºæ™¯**ï¼š
- MCP æœªå¯ç”¨æˆ–åŒæ­¥å»¶è¿Ÿ
- éœ€è¦ç²¾ç¡®ç« èŠ‚çº§åˆ«çš„æ—¶é—´æˆ³
- æ‰‹åŠ¨ç¼–è¾‘ JSON åå³æ—¶æŸ¥çœ‹

### Layer 1: å•æ–‡ä»¶ JSONï¼ˆå…œåº•ï¼‰

```bash
# ä¼ ç»Ÿæ¨¡å¼ï¼ŒåŠ è½½å®Œæ•´æ–‡ä»¶
timeline_data=$(cat spec/tracking/timeline.json)
```

**å‘ä¸‹å…¼å®¹**ï¼šå°å‹é¡¹ç›®ï¼ˆ< 300 ç« ï¼‰ç»§ç»­ä½¿ç”¨å•æ–‡ä»¶æ¨¡å¼

### å‚æ•°è¿‡æ»¤è¡Œä¸º

- **`--volume vol-XX`**: ä»…åŠ è½½æŒ‡å®šå·çš„æ—¶é—´çº¿äº‹ä»¶ï¼ˆLayer 3/2 ç”Ÿæ•ˆï¼ŒLayer 1 éœ€æ‰‹åŠ¨è¿‡æ»¤ï¼‰
- **`--recent N`**: æ˜¾ç¤ºæœ€è¿‘ N ä¸ªäº‹ä»¶ï¼ˆLayer 3 ç›´æ¥é™åˆ¶ï¼ŒLayer 1/2 å–æœ€å N æ¡ï¼‰

## åŠŸèƒ½

1. **æ—¶é—´è®°å½•** - è¿½è¸ªæ¯ä¸ªç« èŠ‚çš„æ—¶é—´ç‚¹
2. **å¹¶è¡Œäº‹ä»¶** - ç®¡ç†åŒæ—¶å‘ç”Ÿçš„å¤šçº¿å‰§æƒ…
3. **å†å²å¯¹ç…§** - ä¸çœŸå®å†å²äº‹ä»¶å¯¹æ¯”ï¼ˆå†å²å°è¯´ï¼‰
4. **é€»è¾‘éªŒè¯** - æ£€æŸ¥æ—¶é—´è·¨åº¦çš„åˆç†æ€§

## ä½¿ç”¨æ–¹æ³•

æ‰§è¡Œè„šæœ¬ {SCRIPT}ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š

### å­å‘½ä»¤

- **`add`** - æ·»åŠ æ—¶é—´èŠ‚ç‚¹
  - åœ¨æŒ‡å®šç« èŠ‚è®°å½•æ—¶é—´æˆ³
  - æ”¯æŒ `--volume` è‡ªåŠ¨å†™å…¥å¯¹åº”å·åˆ†ç‰‡

- **`check`** - éªŒè¯æ—¶é—´è¿ç»­æ€§
  - æ£€æµ‹æ—¶é—´å†²çªï¼ˆé¡ºåºã€å¹¶è¡Œã€æŒç»­ã€è·³è·ƒã€å¹´é¾„ï¼‰
  - `--volume vol-XX`: ä»…æ£€æŸ¥æŒ‡å®šå·
  - `--recent N`: ä»…æ£€æŸ¥æœ€è¿‘ N ä¸ªäº‹ä»¶

- **`show`** - æ˜¾ç¤ºæ—¶é—´çº¿æ¦‚è§ˆ
  - ç”Ÿæˆå•çº¿æˆ–å¤šçº¿ç¨‹æ—¶é—´è½´å¯è§†åŒ–
  - `--volume vol-XX`: ä»…æ˜¾ç¤ºæŒ‡å®šå·äº‹ä»¶
  - `--recent N`: ä»…æ˜¾ç¤ºæœ€è¿‘ N ä¸ªäº‹ä»¶

- **`sync`** - åŒæ­¥å¹¶è¡Œäº‹ä»¶
  - å¯¹é½å¤šçº¿ç¨‹å™äº‹çš„æ—¶é—´ç‚¹
  - æ ‡è®°çº¿ç¨‹äº¤æ±‡ç‚¹

## æ—¶é—´çº¿æ•°æ®

æ—¶é—´çº¿ä¿¡æ¯å­˜å‚¨åœ¨ `spec/tracking/timeline.json` ä¸­ï¼š
- æ•…äº‹å†…æ—¶é—´ï¼ˆå¹´/æœˆ/æ—¥ï¼‰
- ç« èŠ‚å¯¹åº”å…³ç³»
- é‡è¦äº‹ä»¶æ ‡è®°
- æ—¶é—´è·¨åº¦è®¡ç®—

## ç¤ºä¾‹è¾“å‡º

```
ğŸ“… æ•…äº‹æ—¶é—´çº¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å½“å‰æ—¶é—´ï¼šä¸‡å†ä¸‰åå¹´æ˜¥

ç¬¬1ç«   | ä¸‡å†äºŒåä¹å¹´å†¬æœˆ | ç©¿è¶Šäº‹ä»¶
ç¬¬4ç«   | ä¸‡å†ä¸‰åå¹´æ­£æœˆ   | åŒ—ä¸Šèµ´è€ƒ
ç¬¬6ç«   | ä¸‡å†ä¸‰åå¹´äºŒæœˆ   | ä¼šè¯•
ç¬¬8ç«   | ä¸‡å†ä¸‰åå¹´ä¸‰æœˆ   | æ®¿è¯•
ç¬¬61ç«  | ä¸‡å†ä¸‰åå¹´å››æœˆ   | [å¾…å†™]

â±ï¸ æ—¶é—´è·¨åº¦ï¼š5ä¸ªæœˆ
ğŸ”„ å¹¶è¡Œäº‹ä»¶ï¼šæ—¥æœ¬å…¥ä¾µæœé²œ
```

## æ•°æ®å†™å…¥åè®®

æ—¶é—´çº¿æ•°æ®æ›´æ–°éµå¾ªä»¥ä¸‹åè®®ï¼š

### åˆ†ç‰‡æ¨¡å¼ï¼ˆspec/tracking/volumes/ å­˜åœ¨ï¼‰

1. **ç¡®å®šç›®æ ‡å·**ï¼š
   - å¦‚æœå‘½ä»¤æŒ‡å®š `--volume vol-XX`ï¼Œå†™å…¥å¯¹åº”å·
   - å¦‚æœåŸºäºç« èŠ‚å·ï¼ˆå¦‚ `add` å‘½ä»¤ï¼‰ï¼Œæ ¹æ®ç« èŠ‚å·ç¡®å®šå·ï¼š
     ```bash
     # ç¤ºä¾‹ï¼šch-042 å±äº vol-02ï¼ˆå‡è®¾æ¯å· 50 ç« ï¼‰
     volume_num=$((chapter_num / 50 + 1))
     target_volume="vol-$(printf '%02d' $volume_num)"
     ```

2. **å†™å…¥åˆ†ç‰‡æ–‡ä»¶**ï¼š
   ```bash
   # å†™å…¥æŒ‡å®šå·çš„ timeline.json
   Write(spec/tracking/volumes/${target_volume}/timeline.json)
   ```

3. **æ›´æ–°å…¨å±€æ‘˜è¦**ï¼ˆå¦‚æœäº‹ä»¶è·¨åº¦å½±å“æ‘˜è¦ç»Ÿè®¡ï¼‰ï¼š
   ```bash
   # æ›´æ–° timeline-summary.json çš„ç»Ÿè®¡ä¿¡æ¯
   Write(spec/tracking/summary/timeline-summary.json)
   ```

4. **è§¦å‘ MCP åŒæ­¥**ï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼š
   ```bash
   mcp-cli call novelws-mcp/sync_from_json '{
     "mode": "incremental",
     "tables": ["events"]
   }'
   ```

### å•æ–‡ä»¶æ¨¡å¼ï¼ˆä¼ ç»Ÿï¼‰

ç›´æ¥å†™å…¥å®Œæ•´ `timeline.json`ï¼š
```bash
Write(spec/tracking/timeline.json)
```

### å†™å…¥ç¤ºä¾‹

```typescript
// add å‘½ä»¤ï¼šæ·»åŠ æ—¶é—´èŠ‚ç‚¹åˆ°ç¬¬ 42 ç« 
const chapterNum = 42;
const volumeNum = Math.floor((chapterNum - 1) / 50) + 1;
const targetVolume = `vol-${String(volumeNum).padStart(2, '0')}`;

// è¯»å–ç›®æ ‡å·çš„ timeline åˆ†ç‰‡
const timelinePath = isSharded
  ? `spec/tracking/volumes/${targetVolume}/timeline.json`
  : 'spec/tracking/timeline.json';

const timeline = JSON.parse(fs.readFileSync(timelinePath));

// æ·»åŠ æ–°äº‹ä»¶
timeline.events.push({
  chapter: 'ch-042',
  date: 'ä¸‡å†ä¸‰åå¹´å››æœˆåäº”',
  description: 'ä¸»è§’çªç ´ç­‘åŸºæœŸ',
  type: 'major'
});

// å†™å›åˆ†ç‰‡
fs.writeFileSync(timelinePath, JSON.stringify(timeline, null, 2));

// åŒæ­¥åˆ° MCPï¼ˆå¦‚æœå¯ç”¨ï¼‰
if (mcpEnabled) {
  await mcp.call('novelws-mcp/sync_from_json', {
    mode: 'incremental',
    tables: ['events']
  });
}
```

---
## å¢å¼ºåŠŸèƒ½

### æ—¶é—´çº¿å¯è§†åŒ–

#### å•çº¿æ—¶é—´çº¿è§†å›¾

```
ğŸ“… æ•…äº‹æ—¶é—´çº¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[å¹´ä»½/æ—¥æœŸ]  [äº‹ä»¶]                    [ç« èŠ‚]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¬¬ 1 å¤©      ä¸»è§’å…¥å­¦                   ç¬¬ 1 ç« 
  â”‚
ç¬¬ 1 å¤©      é‡åˆ°å¸ˆå§                   ç¬¬ 1 ç« 
  â”‚
ç¬¬ 3 å¤©      ç¬¬ä¸€æ¬¡ä¿®ç‚¼                 ç¬¬ 2 ç« 
  â”‚
ç¬¬ 7 å¤©      çªç ´ç»ƒæ°”ä¸€å±‚               ç¬¬ 3 ç« 
  â”Š (è·³è·ƒï¼š20 å¤©)
ç¬¬ 27 å¤©     å‚åŠ é—¨æ´¾è€ƒæ ¸               ç¬¬ 4 ç« 
  â”‚
ç¬¬ 27 å¤©     ä¸åæ´¾åˆæ¬¡å†²çª             ç¬¬ 4 ç« 
  â”‚
ç¬¬ 30 å¤©     å¤–å‡ºå†ç»ƒ                   ç¬¬ 5 ç« 
  â”Š (è·³è·ƒï¼š60 å¤©)
ç¬¬ 90 å¤©     å†ç»ƒå½’æ¥                   ç¬¬ 8 ç« 
```

#### å¤šçº¿ç¨‹æ—¶é—´å¯¹é½è§†å›¾

å½“æ•…äº‹æœ‰å¤šæ¡å™äº‹çº¿æ—¶ï¼Œå±•ç¤ºå„çº¿åœ¨åŒä¸€æ—¶é—´è½´ä¸Šçš„å¯¹é½æƒ…å†µï¼š

```
ğŸ“… å¤šçº¿ç¨‹æ—¶é—´çº¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ—¶é—´        ä¸»çº¿ï¼ˆä¸»è§’ï¼‰      æ”¯çº¿1ï¼ˆè§’è‰²Bï¼‰    æ”¯çº¿2ï¼ˆè§’è‰²Cï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¬¬ 1 å¤©     å…¥å­¦ [ch1]        â€”                 â€”
ç¬¬ 3 å¤©     ä¿®ç‚¼ [ch2]        â€”                 â€”
ç¬¬ 7 å¤©     çªç ´ [ch3]        å‡ºå‘ [ch4]        â€”
ç¬¬ 15 å¤©    â€”                 åˆ°è¾¾ [ch5]        æ¥åˆ°ä»»åŠ¡ [ch6]
ç¬¬ 20 å¤©    è€ƒæ ¸ [ch7]        è°ƒæŸ¥ [ch8]        å‡ºå‘ [ch9]
ç¬¬ 27 å¤©    å†²çª [ch10]       å‘ç°çº¿ç´¢ [ch11]   â˜… ä¸ä¸»è§’ç›¸é‡ [ch10]
```

**æ—¶é—´å¯¹é½è§„åˆ™**ï¼š
- åŒä¸€å¤©å‘ç”Ÿçš„äº‹ä»¶å¯¹é½åœ¨åŒä¸€è¡Œ
- `â€”` è¡¨ç¤ºè¯¥çº¿åœ¨æ­¤æ—¶é—´ç‚¹æ— æ´»åŠ¨
- `â˜…` æ ‡è®°çº¿ç¨‹äº¤æ±‡ç‚¹
- æ—¶é—´è·³è·ƒç”¨ `â”Š` è¡¨ç¤º

### æ—¶é—´å†²çªæ£€æµ‹

è‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹ç±»å‹çš„æ—¶é—´å†²çªï¼š

| å†²çªç±»å‹ | æè¿° | ç¤ºä¾‹ |
|---------|------|------|
| é¡ºåºå†²çª | äº‹ä»¶ A åº”åœ¨äº‹ä»¶ B ä¹‹å‰ï¼Œä½†ç« èŠ‚é¡ºåºç›¸å | ç¬¬ 5 ç« å†™ã€Œä¸‰å¤©åã€ï¼Œç¬¬ 6 ç« å†™ã€Œæ˜¨å¤©ã€ |
| å¹¶è¡Œå†²çª | åŒä¸€è§’è‰²åŒä¸€æ—¶é—´å‡ºç°åœ¨ä¸¤ä¸ªåœ°ç‚¹ | è§’è‰²A åœ¨ç¬¬ 10 ç« ï¼ˆç¬¬ 5 å¤©ï¼‰åœ¨åŸä¸œï¼Œç¬¬ 11 ç« ï¼ˆç¬¬ 5 å¤©ï¼‰åœ¨åŸè¥¿ |
| æŒç»­å†²çª | äº‹ä»¶æŒç»­æ—¶é—´ä¸æè¿°ä¸ç¬¦ | ã€Œä¸‰å¤©çš„æ—…ç¨‹ã€ä½†åªå†™äº†ä¸€ä¸ªåœºæ™¯ |
| è·³è·ƒå†²çª | æ—¶é—´è·³è·ƒæœŸé—´æœ‰æœªäº¤ä»£çš„äº‹ä»¶ | è·³è¿‡ 30 å¤©ï¼Œä½†æœŸé—´åº”æœ‰é—¨æ´¾è€ƒæ ¸ |
| å¹´é¾„å†²çª | è§’è‰²å¹´é¾„ä¸æ—¶é—´çº¿ä¸ç¬¦ | å¼€ç¯‡ 16 å²ï¼Œä¸€å¹´åä»å†™ 16 å² |

#### å†²çªæŠ¥å‘Šæ ¼å¼

```
âš ï¸ æ—¶é—´å†²çªæ£€æµ‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”´ ä¸¥é‡å†²çªï¼š
1. å¹¶è¡Œå†²çªï¼šè§’è‰²A åœ¨ç¬¬ 5 å¤©åŒæ—¶å‡ºç°åœ¨ä¸¤ä¸ªåœ°ç‚¹
   - ç¬¬ 10 ç« ï¼šè§’è‰²A åœ¨åŸä¸œæˆ˜æ–—
   - ç¬¬ 11 ç« ï¼šè§’è‰²A åœ¨åŸè¥¿è´­ç‰©ï¼ˆåŒä¸€å¤©ï¼‰
   â†’ å»ºè®®ï¼šè°ƒæ•´ç¬¬ 11 ç« æ—¶é—´ä¸ºç¬¬ 6 å¤©

âš ï¸ è½»å¾®å†²çªï¼š
2. æŒç»­å†²çªï¼šç¬¬ 5-8 ç« æè¿°ã€Œä¸‰å¤©æ—…ç¨‹ã€ï¼Œä½†å†…å®¹åªè¦†ç›– 1 å¤©
   â†’ å»ºè®®ï¼šè¡¥å……æ—…é€”ä¸­çš„åœºæ™¯ï¼Œæˆ–ç¼©çŸ­æ—…ç¨‹æ—¶é—´

ğŸ’¡ æç¤ºï¼š
3. æ—¶é—´è·³è·ƒï¼šç¬¬ 8-9 ç« ä¹‹é—´è·³è¿‡ 60 å¤©
   â†’ ç¡®è®¤ï¼šè¿™ 60 å¤©å†…æ˜¯å¦æœ‰éœ€è¦äº¤ä»£çš„äº‹ä»¶ï¼Ÿ
```

---
## ğŸ”— å‘½ä»¤é“¾å¼æç¤º

**å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œè‡ªåŠ¨é™„åŠ ä¸‹ä¸€æ­¥å»ºè®®**ï¼š

```
ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®ï¼š
1ï¸âƒ£ `/write [ç« èŠ‚å·]` â€” æ—¶é—´çº¿ç¡®è®¤æ— è¯¯ï¼Œç»§ç»­å†™ä½œ
2ï¸âƒ£ `/track --check` â€” æ‰§è¡Œæ·±åº¦ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆå«æ—¶é—´çº¿éªŒè¯ï¼‰
3ï¸âƒ£ `/analyze --focus=logic` â€” æ·±åº¦æŸ¥æ‰¾æ—¶é—´çº¿é€»è¾‘æ¼æ´
```
