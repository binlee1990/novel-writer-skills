---
name: timeline
description: 管理和验证故事时间线
argument-hint: [add | check | show | sync]
allowed-tools: Read(//spec/tracking/timeline.json), Read(//spec/tracking/timeline.json), Write(//spec/tracking/timeline.json), Write(//spec/tracking/timeline.json), Read(//stories/**/content/**), Read(//stories/**/content/**), Bash(find:*), Bash(*)
scripts:
  sh: .specify/scripts/bash/check-timeline.sh
  ps: .specify/scripts/powershell/check-timeline.ps1
---

# 时间线管理

维护故事的时间轴，确保时间逻辑的一致性。

## 资源加载（可选）

本命令用于管理故事时间线，默认读取 `tracking/timeline.json`。

### 可选配置

```yaml
resource-loading:
  timeline:
    knowledge-base:
      craft:
        - pacing  # 时间节奏控制
    skills:
      quality-assurance:
        - consistency-checker  # 时间线一致性检查
```

**推荐资源**: pacing.md（时间节奏控制）

## 功能

1. **时间记录** - 追踪每个章节的时间点
2. **并行事件** - 管理同时发生的多线剧情
3. **历史对照** - 与真实历史事件对比（历史小说）
4. **逻辑验证** - 检查时间跨度的合理性

## 使用方法

执行脚本 {SCRIPT}，支持以下操作：
- `add` - 添加时间节点
- `check` - 验证时间连续性
- `show` - 显示时间线概览
- `sync` - 同步并行事件

## 时间线数据

时间线信息存储在 `spec/tracking/timeline.json` 中：
- 故事内时间（年/月/日）
- 章节对应关系
- 重要事件标记
- 时间跨度计算

## 示例输出

```
📅 故事时间线
━━━━━━━━━━━━━━━━━━━━
当前时间：万历三十年春

第1章  | 万历二十九年冬月 | 穿越事件
第4章  | 万历三十年正月   | 北上赴考
第6章  | 万历三十年二月   | 会试
第8章  | 万历三十年三月   | 殿试
第61章 | 万历三十年四月   | [待写]

⏱️ 时间跨度：5个月
🔄 并行事件：日本入侵朝鲜
```

---

## 增强功能

### 时间线可视化

#### 单线时间线视图



#### 多线程时间对齐视图

当故事有多条叙事线时，展示各线在同一时间轴上的对齐情况：



**时间对齐规则**：
- 同一天发生的事件对齐在同一行
- `—` 表示该线在此时间点无活动
- `★` 标记线程交汇点
- 时间跳跃用 `┊` 表示

### 时间冲突检测

自动检测以下类型的时间冲突：

| 冲突类型 | 描述 | 示例 |
|---------|------|------|
| 顺序冲突 | 事件 A 应在事件 B 之前，但章节顺序相反 | 第 5 章写「三天后」，第 6 章写「昨天」 |
| 并行冲突 | 同一角色同一时间出现在两个地点 | 角色A 在第 10 章（第 5 天）在城东，第 11 章（第 5 天）在城西 |
| 持续冲突 | 事件持续时间与描述不符 | 「三天的旅程」但只写了一个场景 |
| 跳跃冲突 | 时间跳跃期间有未交代的事件 | 跳过 30 天，但期间应有门派考核 |
| 年龄冲突 | 角色年龄与时间线不符 | 开篇 16 岁，一年后仍写 16 岁 |

#### 冲突报告格式



---
## 增强功能

### 时间线可视化

#### 单线时间线视图

```
📅 故事时间线
━━━━━━━━━━━━━━━━━━━━

[年份/日期]  [事件]                    [章节]
─────────────────────────────────────────────
第 1 天      主角入学                   第 1 章
  │
第 1 天      遇到师姐                   第 1 章
  │
第 3 天      第一次修炼                 第 2 章
  │
第 7 天      突破练气一层               第 3 章
  ┊ (跳跃：20 天)
第 27 天     参加门派考核               第 4 章
  │
第 27 天     与反派初次冲突             第 4 章
  │
第 30 天     外出历练                   第 5 章
  ┊ (跳跃：60 天)
第 90 天     历练归来                   第 8 章
```

#### 多线程时间对齐视图

当故事有多条叙事线时，展示各线在同一时间轴上的对齐情况：

```
📅 多线程时间线
━━━━━━━━━━━━━━━━━━━━

时间        主线（主角）      支线1（角色B）    支线2（角色C）
──────────────────────────────────────────────────────────
第 1 天     入学 [ch1]        —                 —
第 3 天     修炼 [ch2]        —                 —
第 7 天     突破 [ch3]        出发 [ch4]        —
第 15 天    —                 到达 [ch5]        接到任务 [ch6]
第 20 天    考核 [ch7]        调查 [ch8]        出发 [ch9]
第 27 天    冲突 [ch10]       发现线索 [ch11]   ★ 与主角相遇 [ch10]
```

**时间对齐规则**：
- 同一天发生的事件对齐在同一行
- `—` 表示该线在此时间点无活动
- `★` 标记线程交汇点
- 时间跳跃用 `┊` 表示

### 时间冲突检测

自动检测以下类型的时间冲突：

| 冲突类型 | 描述 | 示例 |
|---------|------|------|
| 顺序冲突 | 事件 A 应在事件 B 之前，但章节顺序相反 | 第 5 章写「三天后」，第 6 章写「昨天」 |
| 并行冲突 | 同一角色同一时间出现在两个地点 | 角色A 在第 10 章（第 5 天）在城东，第 11 章（第 5 天）在城西 |
| 持续冲突 | 事件持续时间与描述不符 | 「三天的旅程」但只写了一个场景 |
| 跳跃冲突 | 时间跳跃期间有未交代的事件 | 跳过 30 天，但期间应有门派考核 |
| 年龄冲突 | 角色年龄与时间线不符 | 开篇 16 岁，一年后仍写 16 岁 |

#### 冲突报告格式

```
⚠️ 时间冲突检测
━━━━━━━━━━━━━━━━━━━━

🔴 严重冲突：
1. 并行冲突：角色A 在第 5 天同时出现在两个地点
   - 第 10 章：角色A 在城东战斗
   - 第 11 章：角色A 在城西购物（同一天）
   → 建议：调整第 11 章时间为第 6 天

⚠️ 轻微冲突：
2. 持续冲突：第 5-8 章描述「三天旅程」，但内容只覆盖 1 天
   → 建议：补充旅途中的场景，或缩短旅程时间

💡 提示：
3. 时间跳跃：第 8-9 章之间跳过 60 天
   → 确认：这 60 天内是否有需要交代的事件？
```

---
## 🔗 命令链式提示

**命令执行完成后，自动附加下一步建议**：

```
💡 下一步建议：
1️⃣ `/write [章节号]` — 时间线确认无误，继续写作
2️⃣ `/track --check` — 执行深度一致性检查（含时间线验证）
3️⃣ `/analyze --focus=logic` — 深度查找时间线逻辑漏洞
```
