---
name: guide
description: "智能引导 — 根据当前故事状态自动推荐下一步操作，帮助新用户快速上手"
argument-hint: [故事目录名]
allowed-tools: Read, Glob, Grep
---

# /guide — 智能引导中心

## 概述

自动检测当前故事的创作阶段和状态，推荐最优的下一步操作。适合新用户快速上手，也适合老用户在中断后快速恢复。

## 执行流程

### Step 1: 状态检测

扫描故事目录，检测以下文件的存在和状态：

| 检测项 | 文件 | 状态 |
|--------|------|------|
| 规格书 | `specification.md` | 不存在 / 草案 / 完成 |
| 创作计划 | `creative-plan.md` | 不存在 / 草案 / 完成 |
| 任务列表 | `tasks.md` | 不存在 / 有待办 / 全部完成 |
| 章节内容 | `content/*.md` | 0 章 / N 章 |
| 角色数据 | `spec/tracking/character-state.json` | 不存在 / N 个角色 |
| 情节追踪 | `spec/tracking/plot-tracker.json` | 不存在 / 有数据 |
| 时间线 | `spec/tracking/timeline.json` | 不存在 / 有数据 |
| 写作断点 | `spec/tracking/write-checkpoint.json` | 不存在 / 有未完成 |

### Step 2: 阶段判断

根据检测结果判断当前阶段：

```
阶段 0：空白项目（无任何文件）
阶段 1：构思中（有 specification.md 草案）
阶段 2：规格完成（specification.md 完成，无 plan）
阶段 3：规划完成（有 creative-plan.md，无 tasks）
阶段 4：任务就绪（有 tasks.md，无章节内容）
阶段 5：写作中（有部分章节内容）
阶段 6：写作中断（有 write-checkpoint.json 未完成）
阶段 7：卷完成（一卷写完，待规划下一卷）
阶段 8：全书完成（所有任务完成）
```

### Step 3: 输出引导

根据阶段输出不同的引导信息：

#### 阶段 0：空白项目

```
🚀 欢迎开始新故事！
━━━━━━━━━━━━━━━━━━━━

看起来这是一个全新的项目。推荐按以下顺序开始：

1️⃣ /specify [故事名] — 创建故事规格书（定义故事的核心设定）
   💡 如果你已经有明确的想法，可以直接提供主题描述
   💡 如果还在构思，/specify 会引导你逐步完善

📚 完整创作流程：
/specify → /clarify → /plan → /tasks → /write → /analyze
```

#### 阶段 1：构思中

```
📝 故事构思中
━━━━━━━━━━━━━━━━━━━━

📋 规格书状态：草案（Level [N]）

推荐操作：
1️⃣ /specify [故事名] — 继续完善规格书（当前 Level [N]，建议升至 Level 4）
2️⃣ /clarify [故事名] — 澄清规格书中的待定项

⚠️ 待定项：[列出 specification.md 中标记为「需要澄清」的项目数量]
```

#### 阶段 2：规格完成

```
✅ 规格书已完成
━━━━━━━━━━━━━━━━━━━━

推荐操作：
1️⃣ /plan [故事名] — 制定创作计划（推荐）
2️⃣ /character create — 创建角色档案
3️⃣ /specify --world — 补充世界观设定（如需要）
```

#### 阶段 3：规划完成

```
✅ 创作计划已完成
━━━━━━━━━━━━━━━━━━━━

推荐操作：
1️⃣ /tasks [故事名] — 生成写作任务列表（推荐）
2️⃣ /plan --detail vol-01 — 细化第一卷的逐章规划
3️⃣ /character create — 创建/补充角色档案
```

#### 阶段 4：任务就绪

```
✅ 任务列表已就绪
━━━━━━━━━━━━━━━━━━━━

📋 待写任务：[N] 个
📖 第一个任务：[任务标题]

推荐操作：
1️⃣ /write [章节号] — 开始写作第一章（推荐）
2️⃣ /recap [故事名] — 查看写作前的上下文简报
3️⃣ /character list — 确认角色状态
```

#### 阶段 5：写作中

```
📖 写作进行中
━━━━━━━━━━━━━━━━━━━━

📊 进度：第 [N] 章 / 共 [M] 章（[X]%）
📝 最近完成：第 [K] 章 — [标题]
📋 下一个任务：[任务标题]

推荐操作：
1️⃣ /write [下一章节号] — 继续写作（推荐）
2️⃣ /recap [故事名] — 查看上下文简报（如果离开了一段时间）
3️⃣ /analyze [故事名] — 分析已写内容的质量
4️⃣ /track --check — 检查 tracking 数据健康度

💡 快捷操作：
- /write --fast [章节号] — 快写模式（灵感充足时）
- /analyze --focus=hook — 检查钩子质量
- /character list — 查看角色状态
```

#### 阶段 6：写作中断

```
⏸️ 发现未完成的写作
━━━━━━━━━━━━━━━━━━━━

📖 中断章节：第 [N] 章 — [标题]
📊 已写：[X] 字 / [Y] 字
⏰ 中断时间：[时间]

推荐操作：
1️⃣ /write [章节号] — 从断点恢复写作（推荐）
2️⃣ /recap [故事名] — 先看上下文简报再继续
3️⃣ 放弃断点，重新开始
```

#### 阶段 7：卷完成

```
🎉 第 [X] 卷写作完成！
━━━━━━━━━━━━━━━━━━━━

📊 本卷统计：[N] 章，[M] 字

推荐操作：
1️⃣ /analyze [故事名] --range=vol-[X] — 分析本卷质量（推荐）
2️⃣ /plan --detail vol-[X+1] — 规划下一卷
3️⃣ /track --check — 检查 tracking 数据
4️⃣ /checklist — 执行卷末检查清单
```

#### 阶段 8：全书完成

```
🏆 恭喜！全书写作完成！
━━━━━━━━━━━━━━━━━━━━

📊 全书统计：[N] 章，[M] 字

推荐操作：
1️⃣ /analyze [故事名] — 全书质量分析（推荐）
2️⃣ /checklist — 执行最终检查清单
3️⃣ /analyze --focus=reader — 读者体验分析
4️⃣ /analyze --focus=hook — 钩子质量分析
```

### Step 4: 健康检查（附加）

无论处于哪个阶段，都执行快速健康检查：

```
🔍 健康检查
━━━━━━━━━━━━━━━━━━━━
✅ 规格书：完整
✅ 创作计划：完整
⚠️ 角色数据：3 个角色中有 1 个超过 5 章未出场
✅ 情节追踪：正常
⚠️ 伏笔：2 个伏笔紧急度 > 0.8
✅ 时间线：无冲突
```

#### 反馈状态检查

在健康检查中，检测是否有未处理的分析反馈：

```
🔄 未处理反馈：[N] 条
  规格书反馈：[A] 条 → 运行 /specify --feedback
  计划反馈  ：[B] 条 → 运行 /plan --feedback
  任务反馈  ：[C] 条 → 运行 /tasks --feedback
```

### Step 5: 智能推荐引擎

在基础阶段引导之外，基于以下数据源进行深度分析，生成个性化推荐：

#### 数据源

| 数据源 | 提取信息 | 推荐依据 |
|--------|---------|---------:|
| `character-state.json` | 角色出场频率、缺席章数 | 角色管理建议 |
| `plot-tracker.json` | 伏笔紧急度、情节进度 | 伏笔回收/情节推进建议 |
| `timeline.json` | 时间线冲突 | 时间线修复建议 |
| `narrative-threads.json` | 叙事线活跃度、信息差 | 视角切换/信息揭示建议 |
| `write-checkpoint.json` | 未完成写作 | 断点恢复建议 |
| 最近 5 章内容 | 节奏、风格、爽点 | 节奏调整建议 |

#### 推荐优先级

推荐按优先级排序（高 → 低）：

```
P0（紧急）：
  - 写作断点未恢复
  - 伏笔紧急度 > 0.9
  - 时间线冲突未解决
  - tracking 数据严重落后

P1（重要）：
  - 角色缺席 > 5 章
  - 爽点间隔 > 5 章
  - 节奏连续 3+ 章单一
  - 叙事线暂停 > 8 章

P2（建议）：
  - 伏笔紧急度 0.5-0.9
  - 风格偏移检测到异常
  - 对话一致性评分 < 7
  - tracking 数据轻微落后

P3（优化）：
  - 可以运行的分析命令
  - 可以补充的角色/世界设定
  - 可以优化的章节
```

#### 输出格式

```
🧠 智能推荐
━━━━━━━━━━━━━━━━━━━━

🔴 紧急（立即处理）：
1. 伏笔「身世之谜」紧急度 0.95，已持续 22 章
   → 建议在第 [N] 章回收
   → 运行 /track --check 查看详情

⚠️ 重要（近期处理）：
2. 角色「师姐」已 7 章未出场
   → 建议在第 [N+1] 或 [N+2] 章安排出场
   → 运行 /character list 查看所有角色状态

3. 最近 4 章节奏偏高，读者可能疲劳
   → 建议第 [N+1] 章安排过渡/日常场景
   → 运行 /analyze --focus=pacing 检查节奏

💡 建议（有空时处理）：
4. tracking 数据落后 2 章
   → 运行 /track --sync

5. 第 18 章风格偏移较大
   → 运行 /analyze --focus=style 查看详情
```

---

## 🔗 命令链式提示

**命令执行完成后，自动附加下一步建议**：

```
💡 下一步建议：
1️⃣ [根据当前阶段自动推荐的首要命令] — [推荐理由]
2️⃣ `/recap` — 查看详细的上下文简报（如已有章节内容）
3️⃣ `/checklist` — 执行质量检查清单（如健康检查有警告）
```
