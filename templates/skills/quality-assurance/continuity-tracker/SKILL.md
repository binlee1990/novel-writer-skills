---
name: continuity-tracker
description: "Use when writing multi-chapter stories - tracks narrative continuity across chapters including character states, object locations, weather, injuries, and scene transitions to prevent continuity errors"
allowed-tools: Read, Grep, Glob
---

# 连续性追踪器

## 核心功能

**追踪章节间的叙事连续性** — 监控角色状态、物品位置、环境变化、关系演变等，防止前后矛盾。

## 激活条件

- 写第 2 章及以后时自动激活
- 提到"连续性""前后矛盾""接上一章""之前提到"等关键词时激活
- 执行 `/analyze` 时作为检查项之一

---

## 追踪类别

| 类别 | 追踪内容 | 示例 |
|------|---------|------|
| **角色状态** | 位置、伤势、情绪、服装、携带物品 | 第 3 章左臂受伤 → 第 5 章不能用左手持剑 |
| **物品追踪** | 关键道具的位置和状态 | 钥匙在第 2 章交给了张三 → 第 6 章不能从口袋里掏出 |
| **环境状态** | 天气、时间、季节、场景布局 | 第 4 章下雨 → 同一天的第 5 章地面应该是湿的 |
| **关系状态** | 角色间的关系变化 | 第 7 章两人吵架决裂 → 第 8 章不能像没事一样聊天 |
| **时间连续** | 日期、时间流逝、事件顺序 | 周一出发三天路程 → 到达应该是周四 |
| **知识状态** | 角色已知/未知的信息 | 主角在第 10 章才知道真相 → 第 8 章不能表现出已知 |

---

## 连续性错误分级

| 级别 | 类型 | 示例 | 影响 |
|------|------|------|------|
| 🔴 **关键** | 硬性矛盾、物理不可能 | 死去的角色在后文出现且无解释 | 严重破坏可信度 |
| ⚠️ **警告** | 状态遗忘、物品丢失 | 受伤的手臂下一章完好如初 | 细心读者会注意到 |
| 📝 **注意** | 细节不一致、时间模糊 | 角色眼睛颜色前后不同 | 可能被忽略但不专业 |

---

## 追踪机制

每章写作完成后自动提取以下快照：

### 1. 角色状态快照
- 当前位置
- 身体状态（伤势、疲劳、饥饿）
- 情绪状态
- 携带物品
- 服装/外貌变化

### 2. 场景环境快照
- 天气状况
- 时间（具体时刻或大致时段）
- 地理位置
- 场景内的物品布局

### 3. 关系变化记录
- 新建立的关系
- 关系状态变化（亲密→疏远、信任→怀疑）
- 承诺/约定

### 4. 关键事件时间戳
- 重要事件发生的时间
- 事件间的因果关系

### 5. 信息传递记录
- 谁知道了什么信息
- 信息的来源
- 信息传递的时间

---

## 警报格式

```
🔗 连续性警报

类型：角色状态矛盾
位置：第 12 章，第 5 段
追踪记录：
  第 8 章：李明左腿被箭射中，行走困难
  第 9 章：李明拄拐前行（✅ 一致）
  第 10 章：李明在客栈休养（✅ 一致）
当前问题：
  第 12 章："李明飞身跃上马背，策马狂奔"
  → 距受伤仅过去 4 天，左腿伤势不可能完全恢复
距事件间隔：4 天（第 8-12 章）
修改建议：
  → 添加治疗/恢复描写，或延长时间跨度
  → 或改为"李明忍着左腿的剧痛，艰难地翻上马背"
严重程度：⚠️ 警告
```

---

## 连续性数据存储格式

```json
{
  "chapter": 8,
  "characters": {
    "李明": {
      "location": "山谷战场",
      "injuries": ["左腿箭伤（严重）"],
      "items": ["断剑", "地图", "干粮（剩余2天）"],
      "mood": "痛苦但坚定",
      "knowledge": ["知道敌军埋伏位置", "不知道张三已叛变"]
    },
    "王芳": {
      "location": "城内医馆",
      "injuries": [],
      "items": ["药箱", "银两（50两）"],
      "mood": "焦虑等待",
      "knowledge": ["知道李明出征", "不知道战况"]
    }
  },
  "environment": {
    "weather": "阴天转小雨",
    "time": "午后申时",
    "season": "深秋"
  },
  "events": [
    {
      "event": "山谷伏击战",
      "time": "申时",
      "participants": ["李明", "敌军"],
      "consequences": ["李明左腿受伤", "敌军撤退"]
    }
  ]
}
```

---

## 与 consistency-checker 的分工

| 维度 | consistency-checker | continuity-tracker |
|------|--------------------|--------------------|
| **关注层面** | 全局一致性（设定、规则、风格） | 章节间连续性（状态、物品、时间） |
| **检查范围** | 全文 | 相邻章节 + 关联事件 |
| **典型问题** | 魔法规则前后矛盾、角色性格突变 | 伤势遗忘、物品凭空出现、时间错乱 |
| **数据来源** | 设定文档 + 全文分析 | 逐章状态快照 |

两者互补：consistency-checker 检查"规则是否一致"，continuity-tracker 检查"状态是否连续"。

---

## 与其他技能协作

- **consistency-checker**：互补关系，共同保障叙事可信度
- **forgotten-elements**：追踪被遗忘的伏笔和悬念
- **multi-thread-narrative**：多线叙事中每条线的连续性独立追踪
- **pov-validator**：视角角色的知识状态是连续性追踪的重要维度
