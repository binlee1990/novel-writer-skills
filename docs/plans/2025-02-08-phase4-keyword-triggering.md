# Phase 4: å…³é”®è¯è§¦å‘æœºåˆ¶å®æ–½è®¡åˆ’

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** å®ç°è¿è¡Œæ—¶åŠ¨æ€èµ„æºåŠ è½½æœºåˆ¶ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥ä¸­çš„å…³é”®è¯æ™ºèƒ½æç¤ºå’ŒåŠ è½½ç›¸å…³çŸ¥è¯†åº“ä¸æŠ€å·§

**Architecture:** åœ¨æ ¸å¿ƒå‘½ä»¤ï¼ˆ/write, /planï¼‰å’Œè¾…åŠ©å‘½ä»¤ï¼ˆ/analyze, /checklistï¼‰ä¸­æ·»åŠ å…³é”®è¯æ‰«ææ¨¡å—ï¼ŒåŸºäº templates/config/keyword-mappings.json è¿›è¡Œæ­£åˆ™åŒ¹é…å’Œä¼˜å…ˆçº§æ’åºï¼Œå»é‡æ£€æŸ¥åå‘ç”¨æˆ·æç¤ºå¹¶åŠ¨æ€åŠ è½½èµ„æº

**Tech Stack:** Markdown Command Templates, JSON Configuration, Regex Pattern Matching

---

## ä»»åŠ¡æ¦‚è§ˆ

1. **Task 1**: åœ¨ /write å‘½ä»¤ä¸­å®ç°å…³é”®è¯æ£€æµ‹é€»è¾‘ï¼ˆ3-4hï¼‰
2. **Task 2**: åœ¨ /plan å‘½ä»¤ä¸­å®ç°å…³é”®è¯æ£€æµ‹é€»è¾‘ï¼ˆ2-3hï¼‰
3. **Task 3**: åœ¨è¾…åŠ©å‘½ä»¤ä¸­å®ç°å…³é”®è¯æ£€æµ‹é€»è¾‘ï¼ˆ2-3hï¼‰
4. **Task 4**: åˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡æ¡£å¹¶éªŒè¯ï¼ˆ1-2hï¼‰

**æ€»é¢„ä¼°å·¥æ—¶**: 8-12h

---

## Task 1: /write å‘½ä»¤çš„å…³é”®è¯æ£€æµ‹å®ç°

**ç›®æ ‡**: åœ¨ /write å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­æ£€æµ‹ç”¨æˆ·è¾“å…¥å’Œå¾…å†™å†…å®¹ä¸­çš„å…³é”®è¯ï¼ŒåŠ¨æ€æç¤ºå¹¶åŠ è½½ç›¸å…³èµ„æº

**Files:**
- Modify: `templates/commands/write.md`ï¼ˆåœ¨ç¬¬ä¸‰å±‚èµ„æºåŠ è½½åæ·»åŠ  Layer 3 å…³é”®è¯è§¦å‘éƒ¨åˆ†ï¼‰
- Reference: `templates/config/keyword-mappings.json`ï¼ˆå·²å­˜åœ¨ï¼‰

### Step 1: è¯»å–å½“å‰ write.md æ‰¾åˆ°æ’å…¥ä½ç½®

**é˜…è¯»æ–‡ä»¶**ï¼š
```bash
# æ‰¾åˆ° "ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½èµ„æºåŠ è½½" éƒ¨åˆ†
Read templates/commands/write.md
```

**é¢„æœŸä½ç½®**: åœ¨ç¬¬ä¸‰å±‚èµ„æºåŠ è½½æœºåˆ¶è¯´æ˜ä¹‹åï¼Œå†™ä½œæ‰§è¡Œæµç¨‹ä¹‹å‰

### Step 2: æ·»åŠ  Layer 3 å…³é”®è¯è§¦å‘ç« èŠ‚

**åœ¨ write.md çš„ "## å†™ä½œæ‰§è¡Œ" ä¹‹å‰æ’å…¥ä»¥ä¸‹å†…å®¹**:

```markdown
### ğŸ†• Layer 3: è¿è¡Œæ—¶å…³é”®è¯è§¦å‘ï¼ˆåŠ¨æ€åŠ è½½ï¼‰

**è§¦å‘æ—¶æœº**:
1. ç”¨æˆ·åœ¨æ‰§è¡Œ `/write` å‘½ä»¤æ—¶æä¾›çš„å‚æ•°ä¸­ï¼ˆå¦‚ `--focus èŠ‚å¥æ§åˆ¶`ï¼‰
2. è¯»å–å½“å‰ä»»åŠ¡æè¿°æ—¶ï¼ˆä» `tasks.md` æå–ï¼‰
3. ç”¨æˆ·åœ¨äº¤äº’è¿‡ç¨‹ä¸­çš„è¾“å…¥ä¸­

**æ£€æŸ¥é…ç½®**:

è¯»å– `specification.md` çš„ `resource-loading.keyword-triggers` é…ç½®ï¼š

```yaml
resource-loading:
  keyword-triggers:
    enabled: true  # é»˜è®¤å¯ç”¨ï¼Œfalse åˆ™è·³è¿‡æ­¤æ­¥éª¤
    custom-mappings:
      "æƒ…æ„ŸèŠ‚å¥": "knowledge-base/craft/pacing.md"
      "ç”œåº¦": "knowledge-base/genres/romance.md"
```

**å¦‚æœ `enabled: false`**ï¼Œè·³è¿‡å…³é”®è¯è§¦å‘æœºåˆ¶ã€‚

**å¦‚æœ `enabled: true` æˆ–æœªé…ç½®**ï¼ˆé»˜è®¤å¯ç”¨ï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

#### 3.1. æ”¶é›†å¾…æ‰«ææ–‡æœ¬

**æ”¶é›†ä»¥ä¸‹æ¥æºçš„æ–‡æœ¬**:
1. å‘½ä»¤å‚æ•°ä¸­çš„æ–‡æœ¬ï¼ˆå¦‚ `--focus å¯¹è¯æŠ€å·§`ï¼‰
2. å½“å‰ä»»åŠ¡æè¿°ï¼ˆä» `tasks.md` è¯»å–å½“å‰ä»»åŠ¡çš„ description å­—æ®µï¼‰
3. ç”¨æˆ·åœ¨å†™ä½œè¿‡ç¨‹ä¸­çš„äº¤äº’è¾“å…¥ï¼ˆå¦‚æç¤º "è¿™æ®µèŠ‚å¥å¤ªæ…¢äº†"ï¼‰

**æ‹¼æ¥æ–‡æœ¬**:
```javascript
const textToScan = [
  commandArgs,      // å‘½ä»¤å‚æ•°
  currentTaskDesc,  // ä»»åŠ¡æè¿°
  userInput         // ç”¨æˆ·è¾“å…¥
].join('\n');
```

#### 3.2. åŠ è½½å…³é”®è¯æ˜ å°„è¡¨

**è¯»å–æ–‡ä»¶**: `templates/config/keyword-mappings.json`

**è§£æç»“æ„**:
```json
{
  "mappings": {
    "craft-knowledge": {
      "pacing": {
        "keywords": ["èŠ‚å¥", "æ‹–æ²“", "å¤ªå¿«", "å¤ªæ…¢"],
        "resources": [
          "templates/knowledge-base/craft/pacing.md",
          "templates/skills/writing-techniques/pacing-control/SKILL.md"
        ],
        "priority": 1
      }
    }
  },
  "regex-patterns": {
    "pacing": "èŠ‚å¥|æ‹–æ²“|å¤ªå¿«|å¤ªæ…¢|è¿‡å¿«|è¿‡æ…¢"
  }
}
```

**åˆå¹¶è‡ªå®šä¹‰æ˜ å°„**:

å¦‚æœ `specification.md` é…ç½®äº† `keyword-triggers.custom-mappings`ï¼Œåˆå¹¶åˆ°æ˜ å°„è¡¨ä¸­ï¼š

```javascript
const customMappings = spec.resourceLoading?.keywordTriggers?.customMappings || {};

// ä¸ºæ¯ä¸ªè‡ªå®šä¹‰æ˜ å°„åˆ›å»ºæ¡ç›®
for (const [keyword, resourcePath] of Object.entries(customMappings)) {
  mappings['custom-' + keyword] = {
    keywords: [keyword],
    resources: [resourcePath],
    priority: 0  // è‡ªå®šä¹‰æ˜ å°„ä¼˜å…ˆçº§æœ€é«˜
  };
}
```

#### 3.3. æ‰§è¡Œå…³é”®è¯åŒ¹é…

**éå†æ‰€æœ‰æ˜ å°„æ¡ç›®**:

```javascript
const matched = [];

for (const [category, items] of Object.entries(mappings)) {
  for (const [name, config] of Object.entries(items)) {
    // ä½¿ç”¨é¢„å®šä¹‰æ­£åˆ™æˆ–æ„å»ºæ­£åˆ™
    const pattern = regexPatterns[name] || config.keywords.join('|');
    const regex = new RegExp(pattern, 'i');  // å¿½ç•¥å¤§å°å†™

    if (regex.test(textToScan)) {
      matched.push({
        category,
        name,
        resources: config.resources,
        priority: config.priority,
        matchedKeyword: textToScan.match(regex)[0]
      });
    }
  }
}
```

**æŒ‰ä¼˜å…ˆçº§æ’åº**:
```javascript
matched.sort((a, b) => a.priority - b.priority);  // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
```

#### 3.4. èµ„æºå»é‡æ£€æŸ¥

**æ£€æŸ¥å·²åŠ è½½èµ„æº**:

ç»´æŠ¤ä¸€ä¸ªå·²åŠ è½½èµ„æºåˆ—è¡¨ï¼ˆä» Layer 1 å’Œ Layer 2 çš„åŠ è½½ç»“æœä¸­è·å–ï¼‰ï¼š

```javascript
const loadedResources = [
  ...layer1Resources,
  ...layer2Resources
];

const newResources = [];

for (const match of matched) {
  for (const resource of match.resources) {
    // è§„èŒƒåŒ–è·¯å¾„ï¼ˆå»é™¤å‰ç¼€ templates/ï¼‰
    const normalizedPath = resource.replace(/^templates\//, '');

    // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½
    const isLoaded = loadedResources.some(loaded =>
      loaded.includes(normalizedPath) || normalizedPath.includes(loaded)
    );

    if (!isLoaded && !newResources.includes(resource)) {
      newResources.push({
        resource,
        trigger: match.name,
        keyword: match.matchedKeyword,
        category: match.category
      });
    }
  }
}
```

#### 3.5. ç”¨æˆ·æç¤ºå’Œç¡®è®¤

**å¦‚æœæœ‰æ–°èµ„æºå¾…åŠ è½½**ï¼Œæ˜¾ç¤ºæç¤ºï¼š

```markdown
---
ğŸ” **å…³é”®è¯è§¦å‘æ£€æµ‹**

æ£€æµ‹åˆ°ä»¥ä¸‹å…³é”®è¯ï¼Œå»ºè®®åŠ è½½ç›¸å…³èµ„æºï¼š

1. **"èŠ‚å¥"** â†’ èŠ‚å¥æ§åˆ¶ (pacing)
   - çŸ¥è¯†åº“: craft/pacing.md
   - æŠ€å·§: writing-techniques/pacing-control

2. **"å¯¹è¯"** â†’ å¯¹è¯æŠ€å·§ (dialogue)
   - çŸ¥è¯†åº“: craft/dialogue.md
   - æŠ€å·§: writing-techniques/dialogue-techniques

æ˜¯å¦åŠ è½½è¿™äº›èµ„æºï¼Ÿ
[Y] å…¨éƒ¨åŠ è½½  [N] è·³è¿‡  [S] é€‰æ‹©æ€§åŠ è½½
---
```

**å¤„ç†ç”¨æˆ·å“åº”**:

- **Y (å…¨éƒ¨åŠ è½½)**: åŠ è½½æ‰€æœ‰å»ºè®®çš„èµ„æº
- **N (è·³è¿‡)**: ä¸åŠ è½½ä»»ä½•èµ„æºï¼Œç»§ç»­å†™ä½œæµç¨‹
- **S (é€‰æ‹©æ€§åŠ è½½)**: é€ä¸ªè¯¢é—®

**é€‰æ‹©æ€§åŠ è½½æµç¨‹**:
```markdown
### 1. èŠ‚å¥æ§åˆ¶ (pacing)

èµ„æºï¼š
- craft/pacing.md
- writing-techniques/pacing-control

æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N]
```

#### 3.6. åŠ¨æ€èµ„æºåŠ è½½

**å¯¹äºç¡®è®¤åŠ è½½çš„èµ„æº**:

```javascript
for (const item of confirmedResources) {
  const { resource, trigger, keyword } = item;

  // åŠ è½½èµ„æºå†…å®¹
  const content = await readFile(resource);

  // æ·»åŠ åˆ°ä¸Šä¸‹æ–‡
  context.push({
    source: resource,
    content: content,
    loadedBy: 'keyword-trigger',
    trigger: trigger,
    keyword: keyword
  });

  // è®°å½•åˆ°æ—¥å¿—
  console.log(`âœ“ åŠ¨æ€åŠ è½½: ${resource} (è§¦å‘è¯: "${keyword}")`);
}
```

**åŠ è½½å®Œæˆæç¤º**:
```markdown
âœ… å·²åŠ è½½ 2 ä¸ªèµ„æºï¼š
  - craft/pacing.md
  - writing-techniques/pacing-control

ç»§ç»­å†™ä½œæµç¨‹...
```

#### 3.7. äº¤äº’è¿‡ç¨‹ä¸­çš„å®æ—¶è§¦å‘

**åœ¨å†™ä½œæ‰§è¡Œè¿‡ç¨‹ä¸­**ï¼Œæ¯å½“ç”¨æˆ·æä¾›æ–°çš„è¾“å…¥æ—¶ï¼š

```javascript
// ç”¨æˆ·è¾“å…¥æ–°çš„æŒ‡ä»¤æˆ–åé¦ˆ
const userFeedback = getUserInput();

// é‡æ–°æ‰«æå…³é”®è¯
const runtimeMatched = scanKeywords(userFeedback);

// è¿‡æ»¤å·²åŠ è½½èµ„æº
const runtimeNew = filterAlreadyLoaded(runtimeMatched, loadedResources);

// å¦‚æœæœ‰æ–°èµ„æºï¼Œæç¤ºç”¨æˆ·
if (runtimeNew.length > 0) {
  promptUserToLoad(runtimeNew);
}
```

**å®æ—¶æç¤ºç¤ºä¾‹**:
```markdown
ğŸ’¡ **æç¤º**: æ£€æµ‹åˆ°å…³é”®è¯ "èŠ‚å¥å¤ªæ…¢"ï¼Œæ˜¯å¦åŠ è½½ pacing-control æŠ€å·§ï¼Ÿ [Y/N]
```

---

### ğŸ†• é…ç½®ç¤ºä¾‹

**å¯ç”¨å…³é”®è¯è§¦å‘ï¼ˆé»˜è®¤ï¼‰**:
```yaml
# specification.md
---
resource-loading:
  keyword-triggers:
    enabled: true
---
```

**ç¦ç”¨å…³é”®è¯è§¦å‘**:
```yaml
---
resource-loading:
  keyword-triggers:
    enabled: false
---
```

**æ·»åŠ è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„**:
```yaml
---
resource-loading:
  keyword-triggers:
    enabled: true
    custom-mappings:
      "æƒ…æ„ŸèŠ‚å¥": "knowledge-base/craft/pacing.md"
      "ç”œåº¦": "knowledge-base/genres/romance.md"
      "è™æ–‡": "knowledge-base/requirements/romance-angst.md"
---
```

**è‡ªå®šä¹‰æ˜ å°„ä¼˜å…ˆçº§æœ€é«˜**ï¼ˆpriority: 0ï¼‰ï¼Œä¼šä¼˜å…ˆäºå†…ç½®æ˜ å°„è¡¨ã€‚
```

### Step 3: æäº¤ä¿®æ”¹

**æäº¤å‘½ä»¤**:
```bash
git add templates/commands/write.md
git commit -m "feat(write): æ·»åŠ  Layer 3 å…³é”®è¯è§¦å‘æœºåˆ¶

- å®ç°å…³é”®è¯æ‰«æï¼ˆå‘½ä»¤å‚æ•°ã€ä»»åŠ¡æè¿°ã€ç”¨æˆ·è¾“å…¥ï¼‰
- æ”¯æŒè‡ªå®šä¹‰å…³é”®è¯æ˜ å°„ï¼ˆspecification.md é…ç½®ï¼‰
- æ”¯æŒç¦ç”¨å…³é”®è¯è§¦å‘ï¼ˆenabled: falseï¼‰
- å®ç°èµ„æºå»é‡æ£€æŸ¥ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
- å®ç°ç”¨æˆ·ç¡®è®¤æµç¨‹ï¼ˆY/N/S ä¸‰ç§æ¨¡å¼ï¼‰
- æ”¯æŒå®æ—¶è§¦å‘ï¼ˆå†™ä½œè¿‡ç¨‹ä¸­çš„åŠ¨æ€åŠ è½½ï¼‰

Ref: Phase 4 Task 1"
```

**éªŒè¯ä¿®æ”¹**:
```bash
# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
cat templates/commands/write.md | grep -A 5 "Layer 3"

# æ£€æŸ¥æäº¤
git log -1 --stat
```

**é¢„æœŸè¾“å‡º**:
```
âœ“ templates/commands/write.md å·²æ·»åŠ  Layer 3 ç« èŠ‚
âœ“ Git commit æˆåŠŸ
```

---

## Task 2: /plan å‘½ä»¤çš„å…³é”®è¯æ£€æµ‹å®ç°

**ç›®æ ‡**: åœ¨ /plan å‘½ä»¤ä¸­å®ç°ç±»ä¼¼çš„å…³é”®è¯è§¦å‘æœºåˆ¶

**Files:**
- Modify: `templates/commands/plan.md`

### Step 1: è¯»å– plan.md å½“å‰å†…å®¹

```bash
Read templates/commands/plan.md
```

**æ‰¾åˆ°æ’å…¥ä½ç½®**: åœ¨èµ„æºåŠ è½½ç« èŠ‚ä¹‹åï¼Œåˆ¶å®šè®¡åˆ’æµç¨‹ä¹‹å‰

### Step 2: æ·»åŠ å…³é”®è¯è§¦å‘ç« èŠ‚

**åœ¨ plan.md ä¸­æ’å…¥ä»¥ä¸‹å†…å®¹**ï¼ˆç®€åŒ–ç‰ˆï¼Œé‡ç”¨ write.md çš„é€»è¾‘ï¼‰:

```markdown
### ğŸ†• Layer 3: è¿è¡Œæ—¶å…³é”®è¯è§¦å‘

**è§¦å‘æ—¶æœº**:
- ç”¨æˆ·æ‰§è¡Œ `/plan` å‘½ä»¤æ—¶çš„å‚æ•°
- è¯»å– `creative-plan.md` å½“å‰å†…å®¹æ—¶
- ç”¨æˆ·åœ¨è§„åˆ’è¿‡ç¨‹ä¸­çš„è¾“å…¥

**å®ç°é€»è¾‘**: å‚è€ƒ `/write` å‘½ä»¤çš„ Layer 3 å…³é”®è¯è§¦å‘æœºåˆ¶

**é…ç½®**: è¯»å– `specification.md` çš„ `resource-loading.keyword-triggers`

**æ‰«ææ–‡æœ¬æ¥æº**:
1. å‘½ä»¤å‚æ•°ï¼ˆå¦‚ `/plan ä¸‹ä¸€ç« èŠ‚å¥åŠ å¿«`ï¼‰
2. ç°æœ‰è®¡åˆ’å†…å®¹ï¼ˆ`creative-plan.md`ï¼‰
3. ç”¨æˆ·äº¤äº’è¾“å…¥

**èµ„æºå»é‡**: è·³è¿‡ Layer 1/2 å·²åŠ è½½çš„èµ„æº

**ç”¨æˆ·ç¡®è®¤**:
```markdown
ğŸ” **å…³é”®è¯è§¦å‘æ£€æµ‹**

æ£€æµ‹åˆ° "èŠ‚å¥åŠ å¿«"ï¼Œå»ºè®®åŠ è½½ï¼š
- craft/pacing.md
- writing-techniques/pacing-control

æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N/S]
```

**åŠ è½½æµç¨‹**: ä¸ `/write` ç›¸åŒ

**é…ç½®ç¤ºä¾‹**:
```yaml
# specification.md
resource-loading:
  keyword-triggers:
    enabled: true  # é»˜è®¤å¯ç”¨
```
```

### Step 3: æäº¤ä¿®æ”¹

```bash
git add templates/commands/plan.md
git commit -m "feat(plan): æ·»åŠ  Layer 3 å…³é”®è¯è§¦å‘æœºåˆ¶

- å®ç°å…³é”®è¯æ‰«æï¼ˆå‚æ•°ã€ç°æœ‰è®¡åˆ’ã€ç”¨æˆ·è¾“å…¥ï¼‰
- å¤ç”¨ /write çš„å…³é”®è¯æ£€æµ‹é€»è¾‘
- æ”¯æŒé…ç½®æ§åˆ¶ï¼ˆenabled/custom-mappingsï¼‰

Ref: Phase 4 Task 2"
```

---

## Task 3: è¾…åŠ©å‘½ä»¤çš„å…³é”®è¯æ£€æµ‹å®ç°

**ç›®æ ‡**: åœ¨ /analyze å’Œ /checklist å‘½ä»¤ä¸­æ·»åŠ è½»é‡çº§å…³é”®è¯è§¦å‘

**Files:**
- Modify: `templates/commands/analyze.md`
- Modify: `templates/commands/checklist.md`

### Step 1: åœ¨ /analyze ä¸­æ·»åŠ å…³é”®è¯è§¦å‘

**è¯»å–æ–‡ä»¶**:
```bash
Read templates/commands/analyze.md
```

**æ’å…¥ä½ç½®**: åœ¨èµ„æºåŠ è½½ç« èŠ‚ä¹‹åï¼Œåˆ†ææ‰§è¡Œä¹‹å‰

**æ·»åŠ å†…å®¹**ï¼ˆè½»é‡çº§ç‰ˆæœ¬ï¼‰:

```markdown
### ğŸ†• Layer 3: å…³é”®è¯è§¦å‘ï¼ˆåˆ†æä¸“ç”¨ï¼‰

**è§¦å‘æ—¶æœº**:
- å‘½ä»¤å‚æ•°ï¼ˆå¦‚ `/analyze --check å¯¹è¯è´¨é‡`ï¼‰
- å¾…åˆ†æå†…å®¹ä¸­çš„é—®é¢˜å…³é”®è¯

**é…ç½®**: è¯»å– `specification.md` çš„ `resource-loading.keyword-triggers.enabled`

**å¦‚æœ `enabled: false`**ï¼Œè·³è¿‡æ­¤æ­¥éª¤ã€‚

**æ‰«æç­–ç•¥**:

1. **å‚æ•°æ‰«æ**: æ£€æŸ¥ `--check` å‚æ•°å€¼
   - å¦‚ `--check å¯¹è¯` â†’ åŠ è½½ craft/dialogue.md
   - å¦‚ `--check èŠ‚å¥` â†’ åŠ è½½ craft/pacing.md

2. **é—®é¢˜æ£€æµ‹æ‰«æ** (å¯é€‰ï¼Œæ‰§è¡Œåˆ†æå)ï¼š
   - åˆ†æå‘ç°å¯¹è¯é—®é¢˜ â†’ æç¤ºåŠ è½½ dialogue-techniques
   - åˆ†æå‘ç°èŠ‚å¥é—®é¢˜ â†’ æç¤ºåŠ è½½ pacing-control

**ç”¨æˆ·ç¡®è®¤**:
```markdown
ğŸ’¡ æ£€æµ‹åˆ° "--check å¯¹è¯"ï¼Œå»ºè®®åŠ è½½ï¼š
- craft/dialogue.md
- writing-techniques/dialogue-techniques

æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N]
```

**æ³¨æ„**: /analyze é€šå¸¸åœ¨ Layer 1 å·²åŠ è½½æ‰€æœ‰ craft knowledgeï¼Œæ­¤æœºåˆ¶ä¸»è¦ç”¨äºåŠ¨æ€åŠ è½½ skillsã€‚
```

**æäº¤**:
```bash
git add templates/commands/analyze.md
git commit -m "feat(analyze): æ·»åŠ è½»é‡çº§å…³é”®è¯è§¦å‘

- æ”¯æŒ --check å‚æ•°å…³é”®è¯æ£€æµ‹
- æ”¯æŒåˆ†æåçš„é—®é¢˜æ£€æµ‹è§¦å‘
- ä¸»è¦ç”¨äºåŠ¨æ€åŠ è½½ skills

Ref: Phase 4 Task 3"
```

### Step 2: åœ¨ /checklist ä¸­æ·»åŠ å…³é”®è¯è§¦å‘

**è¯»å–æ–‡ä»¶**:
```bash
Read templates/commands/checklist.md
```

**æ’å…¥ä½ç½®**: åœ¨èµ„æºåŠ è½½ç« èŠ‚ä¹‹å

**æ·»åŠ å†…å®¹**ï¼ˆæœ€è½»é‡çº§ï¼‰:

```markdown
### ğŸ†• Layer 3: å…³é”®è¯è§¦å‘ï¼ˆå¯é€‰ï¼‰

**è§¦å‘æ—¶æœº**: å‘½ä»¤å‚æ•°ï¼ˆå¦‚ `/checklist --focus èŠ‚å¥`ï¼‰

**é…ç½®**: è¯»å– `specification.md` çš„ `resource-loading.keyword-triggers.enabled`

**å¦‚æœ `enabled: true` ä¸”å‚æ•°åŒ…å«å…³é”®è¯**:

æ£€æµ‹å‚æ•°ä¸­çš„å…³é”®è¯ï¼Œæç¤ºåŠ è½½ç›¸å…³èµ„æºï¼š

```markdown
ğŸ’¡ æ£€æµ‹åˆ° "--focus èŠ‚å¥"ï¼Œå»ºè®®åŠ è½½ï¼š
- craft/pacing.md

æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N]
```

**é»˜è®¤è¡Œä¸º**: å¦‚æœæœªé…ç½® keyword-triggersï¼Œæ­¤æ­¥éª¤ä¸æ‰§è¡Œã€‚
```

**æäº¤**:
```bash
git add templates/commands/checklist.md
git commit -m "feat(checklist): æ·»åŠ æœ€è½»é‡çº§å…³é”®è¯è§¦å‘

- æ”¯æŒ --focus å‚æ•°å…³é”®è¯æ£€æµ‹
- é»˜è®¤ä¸å¯ç”¨ï¼Œéœ€é…ç½® keyword-triggers

Ref: Phase 4 Task 3"
```

---

## Task 4: æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£å’ŒéªŒè¯

**ç›®æ ‡**: åˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡æ¡£ï¼Œè¦†ç›–æ‰€æœ‰å…³é”®è¯è§¦å‘åœºæ™¯

**Files:**
- Create: `docs/plans/phase4-test-cases.md`

### Step 1: åˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

**æ–‡ä»¶å†…å®¹**:

```markdown
# Phase 4: å…³é”®è¯è§¦å‘æœºåˆ¶æµ‹è¯•ç”¨ä¾‹

**åˆ›å»ºæ—¥æœŸ**: 2025-02-08
**Phase**: 4 - å…³é”®è¯è§¦å‘æœºåˆ¶
**ç›®æ ‡**: éªŒè¯è¿è¡Œæ—¶åŠ¨æ€èµ„æºåŠ è½½åŠŸèƒ½

---

## æµ‹è¯•ç¯å¢ƒ

**æµ‹è¯•é¡¹ç›®**:
- ä½¿ç”¨ `templates/` ä½œä¸ºæµ‹è¯•åŸºç¡€
- åˆ›å»ºæµ‹è¯• specification.md é…ç½®

**æµ‹è¯•å·¥å…·**:
- æ‰‹åŠ¨éªŒè¯ï¼ˆé€šè¿‡ Claude Code æ‰§è¡Œå‘½ä»¤ï¼‰
- Git commit å†å²æ£€æŸ¥

---

## Test Case 1: /write å‘½ä»¤å‚æ•°å…³é”®è¯è§¦å‘

**åœºæ™¯**: ç”¨æˆ·åœ¨ `/write` å‘½ä»¤å‚æ•°ä¸­æä¾›å…³é”®è¯

**æµ‹è¯•é…ç½®**:
```yaml
# stories/test-story/specification.md
---
title: "æµ‹è¯•å°è¯´"
resource-loading:
  auto-load: false  # ç¦ç”¨é»˜è®¤åŠ è½½ï¼Œä¾¿äºæµ‹è¯•
  keyword-triggers:
    enabled: true
---
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-01 --focus å¯¹è¯æŠ€å·§
```

**é¢„æœŸè¡Œä¸º**:
1. æ‰«æå‚æ•°æ–‡æœ¬ï¼š"å¯¹è¯æŠ€å·§"
2. åŒ¹é…å…³é”®è¯ï¼š"å¯¹è¯" (dialogue)
3. æç¤ºç”¨æˆ·ï¼š
   ```
   ğŸ” å…³é”®è¯è§¦å‘æ£€æµ‹

   æ£€æµ‹åˆ° "å¯¹è¯"ï¼Œå»ºè®®åŠ è½½ï¼š
   - craft/dialogue.md
   - writing-techniques/dialogue-techniques

   æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N/S]
   ```
4. ç”¨æˆ·é€‰æ‹© Y â†’ åŠ è½½èµ„æº
5. æ§åˆ¶å°æ˜¾ç¤ºï¼š`âœ“ åŠ¨æ€åŠ è½½: craft/dialogue.md (è§¦å‘è¯: "å¯¹è¯")`

**éªŒè¯æ–¹æ³•**:
- æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ—¥å¿—
- ç¡®è®¤èµ„æºåŠ è½½æç¤ºå‡ºç°
- ç¡®è®¤èµ„æºå®é™…åŠ è½½åˆ°ä¸Šä¸‹æ–‡

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 2: /write ä»»åŠ¡æè¿°å…³é”®è¯è§¦å‘

**åœºæ™¯**: tasks.md ä¸­çš„ä»»åŠ¡æè¿°åŒ…å«å…³é”®è¯

**æµ‹è¯•æ•°æ®**:
```markdown
# stories/test-story/tasks.md

## å¾…å†™ä»»åŠ¡

### Task 1: ç¬¬ä¸€ç«  - å¼€ç¯‡
- **ç« èŠ‚**: chapter-01
- **æè¿°**: å†™ä¸€æ®µèŠ‚å¥ç´§å‡‘çš„å¯¹è¯åœºæ™¯ï¼Œå±•ç¤ºä¸¤äººçš„çŸ›ç›¾
- **å­—æ•°**: 2000
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-01
```

**é¢„æœŸè¡Œä¸º**:
1. è¯»å–ä»»åŠ¡æè¿°ï¼š"èŠ‚å¥ç´§å‡‘çš„å¯¹è¯åœºæ™¯"
2. åŒ¹é…å…³é”®è¯ï¼š"èŠ‚å¥" (pacing) + "å¯¹è¯" (dialogue)
3. æç¤ºç”¨æˆ·åŠ è½½ï¼š
   - craft/pacing.md
   - craft/dialogue.md
   - pacing-control skill
   - dialogue-techniques skill

**éªŒè¯æ–¹æ³•**:
- æ£€æŸ¥ä»»åŠ¡æè¿°æ˜¯å¦è¢«æ­£ç¡®æ‰«æ
- éªŒè¯å¤šä¸ªå…³é”®è¯åŒæ—¶è§¦å‘
- éªŒè¯ä¼˜å…ˆçº§æ’åºï¼ˆpriority 1 èµ„æºä¼˜å…ˆï¼‰

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 3: è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„

**åœºæ™¯**: ç”¨æˆ·é…ç½®è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„

**æµ‹è¯•é…ç½®**:
```yaml
# specification.md
---
resource-loading:
  keyword-triggers:
    enabled: true
    custom-mappings:
      "ç”œåº¦": "knowledge-base/genres/romance.md"
      "è™æ–‡": "knowledge-base/requirements/romance-angst.md"
---
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-05 --focus æå‡ç”œåº¦
```

**é¢„æœŸè¡Œä¸º**:
1. æ‰«æå‚æ•°ï¼š"æå‡ç”œåº¦"
2. åŒ¹é…è‡ªå®šä¹‰å…³é”®è¯ï¼š"ç”œåº¦"
3. æç¤ºåŠ è½½ï¼š`knowledge-base/genres/romance.md`
4. ä¼˜å…ˆçº§ï¼šè‡ªå®šä¹‰æ˜ å°„ (priority 0) ä¼˜å…ˆäºå†…ç½®æ˜ å°„

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤è‡ªå®šä¹‰æ˜ å°„è¢«æ­£ç¡®è¯»å–
- ç¡®è®¤ä¼˜å…ˆçº§æœ€é«˜ï¼ˆåœ¨æç¤ºåˆ—è¡¨ä¸­æ’ç¬¬ä¸€ï¼‰
- ç¡®è®¤èµ„æºè·¯å¾„æ­£ç¡®è§£æ

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 4: ç¦ç”¨å…³é”®è¯è§¦å‘

**åœºæ™¯**: ç”¨æˆ·ç¦ç”¨å…³é”®è¯è§¦å‘åŠŸèƒ½

**æµ‹è¯•é…ç½®**:
```yaml
---
resource-loading:
  keyword-triggers:
    enabled: false
---
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-01 --focus å¯¹è¯èŠ‚å¥
```

**é¢„æœŸè¡Œä¸º**:
1. æ£€æµ‹åˆ° `enabled: false`
2. è·³è¿‡å…³é”®è¯æ‰«ææ­¥éª¤
3. **ä¸æ˜¾ç¤º**ä»»ä½•å…³é”®è¯è§¦å‘æç¤º
4. ç›´æ¥è¿›å…¥å†™ä½œæµç¨‹

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤æ²¡æœ‰å…³é”®è¯è§¦å‘æç¤º
- ç¡®è®¤å†™ä½œæµç¨‹æ­£å¸¸è¿›è¡Œ
- ç¡®è®¤æ—¥å¿—ä¸­æ—  "åŠ¨æ€åŠ è½½" è®°å½•

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 5: èµ„æºå»é‡æ£€æŸ¥

**åœºæ™¯**: Layer 1/2 å·²åŠ è½½çš„èµ„æºä¸åº”é‡å¤æç¤º

**æµ‹è¯•é…ç½®**:
```yaml
---
resource-loading:
  auto-load: true  # Layer 1 ä¼šåŠ è½½æ‰€æœ‰ craft knowledge
  keyword-triggers:
    enabled: true
---
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-01 --focus å¯¹è¯
```

**é¢„æœŸè¡Œä¸º**:
1. Layer 1 è‡ªåŠ¨åŠ è½½ï¼šcraft/dialogue.mdï¼ˆå·²åŠ è½½ï¼‰
2. æ‰«æå‚æ•°ï¼š"å¯¹è¯"
3. åŒ¹é…åˆ° craft/dialogue.md
4. **å»é‡æ£€æŸ¥**: å‘ç°å·²åŠ è½½
5. **ä¸æç¤º** craft/dialogue.md
6. **ä»…æç¤º** dialogue-techniques skillï¼ˆå¦‚æœªåŠ è½½ï¼‰

**éªŒè¯æ–¹æ³•**:
- æ£€æŸ¥ Layer 1 åŠ è½½åˆ—è¡¨
- ç¡®è®¤å·²åŠ è½½èµ„æºä¸åœ¨è§¦å‘æç¤ºä¸­
- ç¡®è®¤æœªåŠ è½½çš„ skill æ­£å¸¸æç¤º

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 6: é€‰æ‹©æ€§åŠ è½½ (S æ¨¡å¼)

**åœºæ™¯**: ç”¨æˆ·é€‰æ‹©é€ä¸ªç¡®è®¤èµ„æºåŠ è½½

**æ‰§è¡Œå‘½ä»¤**:
```bash
/write chapter-01 --focus èŠ‚å¥å’Œå¯¹è¯
```

**é¢„æœŸè¡Œä¸º**:
1. åŒ¹é…ä¸¤ä¸ªå…³é”®è¯ï¼špacing + dialogue
2. æç¤ºåŠ è½½ 4 ä¸ªèµ„æº
3. ç”¨æˆ·é€‰æ‹© **S** (é€‰æ‹©æ€§åŠ è½½)
4. é€ä¸ªè¯¢é—®ï¼š
   ```
   ### 1. èŠ‚å¥æ§åˆ¶ (pacing)

   èµ„æºï¼š
   - craft/pacing.md
   - writing-techniques/pacing-control

   æ˜¯å¦åŠ è½½ï¼Ÿ [Y/N]
   ```
5. ç”¨æˆ·å¯¹ç¬¬ 1 ä¸ªé€‰ Yï¼Œç¬¬ 2 ä¸ªé€‰ N
6. ä»…åŠ è½½ç¬¬ 1 ä¸ªèµ„æº

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤é€ä¸ªè¯¢é—®æµç¨‹
- ç¡®è®¤ä»…åŠ è½½ç”¨æˆ·ç¡®è®¤çš„èµ„æº
- ç¡®è®¤è·³è¿‡ç”¨æˆ·æ‹’ç»çš„èµ„æº

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 7: /plan å‘½ä»¤å…³é”®è¯è§¦å‘

**åœºæ™¯**: åœ¨ /plan å‘½ä»¤ä¸­è§¦å‘å…³é”®è¯æ£€æµ‹

**æ‰§è¡Œå‘½ä»¤**:
```bash
/plan ä¸‹ä¸€ç« èŠ‚å¥åŠ å¿«ï¼Œå¢åŠ å¯¹è¯å†²çª
```

**é¢„æœŸè¡Œä¸º**:
1. æ‰«æå‚æ•°ï¼š"èŠ‚å¥åŠ å¿«ï¼Œå¢åŠ å¯¹è¯å†²çª"
2. åŒ¹é…ï¼špacing + dialogue
3. æç¤ºåŠ è½½ç›¸å…³èµ„æº
4. ç”¨æˆ·ç¡®è®¤ååŠ è½½

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤ /plan å‘½ä»¤æ”¯æŒå…³é”®è¯è§¦å‘
- ç¡®è®¤é€»è¾‘ä¸ /write ä¸€è‡´

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 8: /analyze è½»é‡çº§è§¦å‘

**åœºæ™¯**: /analyze --check å‚æ•°è§¦å‘

**æ‰§è¡Œå‘½ä»¤**:
```bash
/analyze --check å¯¹è¯
```

**é¢„æœŸè¡Œä¸º**:
1. æ‰«æ `--check` å‚æ•°å€¼ï¼š"å¯¹è¯"
2. åŒ¹é… dialogue
3. æç¤ºåŠ è½½ dialogue-techniques skillï¼ˆknowledge å·²åœ¨ Layer 1 åŠ è½½ï¼‰

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤å‚æ•°æ‰«ææ­£ç¡®
- ç¡®è®¤åªæç¤ºæœªåŠ è½½çš„èµ„æº

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 9: /checklist æœ€è½»é‡çº§è§¦å‘

**åœºæ™¯**: /checklist --focus å‚æ•°è§¦å‘

**æ‰§è¡Œå‘½ä»¤**:
```bash
/checklist --focus èŠ‚å¥
```

**é¢„æœŸè¡Œä¸º**:
1. æ£€æŸ¥ keyword-triggers.enabled
2. å¦‚æœ enabled: trueï¼Œæ‰«æå‚æ•°
3. æç¤ºåŠ è½½ craft/pacing.md

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤é…ç½®æ§åˆ¶ç”Ÿæ•ˆ
- ç¡®è®¤æç¤ºæ­£ç¡®

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## Test Case 10: å®æ—¶è§¦å‘ï¼ˆå†™ä½œè¿‡ç¨‹ä¸­ï¼‰

**åœºæ™¯**: ç”¨æˆ·åœ¨å†™ä½œè¿‡ç¨‹ä¸­æä¾›æ–°è¾“å…¥

**æ‰§è¡Œæµç¨‹**:
1. æ‰§è¡Œ `/write chapter-01`ï¼ˆåˆå§‹æ— å…³é”®è¯ï¼‰
2. AI è¯¢é—®ï¼š"æ‚¨å¸Œæœ›é‡ç‚¹å…³æ³¨ä»€ä¹ˆï¼Ÿ"
3. ç”¨æˆ·å›å¤ï¼š"æˆ‘è§‰å¾—èŠ‚å¥æœ‰ç‚¹æ…¢"
4. å®æ—¶è§¦å‘æ£€æµ‹

**é¢„æœŸè¡Œä¸º**:
1. æ‰«æç”¨æˆ·è¾“å…¥ï¼š"èŠ‚å¥æœ‰ç‚¹æ…¢"
2. åŒ¹é… pacing
3. æç¤ºï¼š`ğŸ’¡ æ£€æµ‹åˆ° "èŠ‚å¥å¤ªæ…¢"ï¼Œæ˜¯å¦åŠ è½½ pacing-controlï¼Ÿ [Y/N]`
4. ç”¨æˆ·ç¡®è®¤ååŠ¨æ€åŠ è½½

**éªŒè¯æ–¹æ³•**:
- ç¡®è®¤å®æ—¶æ‰«ææœºåˆ¶å·¥ä½œ
- ç¡®è®¤äº¤äº’è¿‡ç¨‹ä¸­çš„è§¦å‘
- ç¡®è®¤èµ„æºåŠ è½½åç«‹å³å¯ç”¨

**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•

---

## éªŒæ”¶æ ‡å‡†

| Test Case | æè¿° | çŠ¶æ€ |
|-----------|------|------|
| TC1 | /write å‚æ•°å…³é”®è¯è§¦å‘ | â¬œ |
| TC2 | /write ä»»åŠ¡æè¿°è§¦å‘ | â¬œ |
| TC3 | è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„ | â¬œ |
| TC4 | ç¦ç”¨å…³é”®è¯è§¦å‘ | â¬œ |
| TC5 | èµ„æºå»é‡æ£€æŸ¥ | â¬œ |
| TC6 | é€‰æ‹©æ€§åŠ è½½ (S æ¨¡å¼) | â¬œ |
| TC7 | /plan å‘½ä»¤è§¦å‘ | â¬œ |
| TC8 | /analyze è½»é‡çº§è§¦å‘ | â¬œ |
| TC9 | /checklist æœ€è½»é‡çº§è§¦å‘ | â¬œ |
| TC10 | å®æ—¶è§¦å‘ï¼ˆäº¤äº’ä¸­ï¼‰ | â¬œ |

**å…¨éƒ¨é€šè¿‡æ ‡å‡†**: 10/10 âœ…

---

## æµ‹è¯•æ‰§è¡Œè®°å½•

### æµ‹è¯•æ‰¹æ¬¡ 1: 2025-02-08

**æ‰§è¡Œè€…**: [å¾…å¡«å†™]
**ç»“æœ**: [å¾…å¡«å†™]

---

## é—®é¢˜å’Œä¿®å¤

### Issue 1: [å¾…å‘ç°]

**æè¿°**: [å¾…å¡«å†™]
**ä¿®å¤**: [å¾…å¡«å†™]
**éªŒè¯**: [å¾…å¡«å†™]

---

## æ€»ç»“

**é€šè¿‡ç‡**: 0/10 (0%)
**é˜»å¡é—®é¢˜**: 0
**å»ºè®®**: æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•ï¼Œä¼˜å…ˆéªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼ˆTC1-TC5ï¼‰
```

### Step 2: æäº¤æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

```bash
git add docs/plans/phase4-test-cases.md
git commit -m "docs: åˆ›å»º Phase 4 æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

- å®šä¹‰ 10 ä¸ªæµ‹è¯•åœºæ™¯
- è¦†ç›–æ‰€æœ‰å…³é”®è¯è§¦å‘åŠŸèƒ½
- åŒ…å«éªŒè¯æ–¹æ³•å’ŒéªŒæ”¶æ ‡å‡†

Ref: Phase 4 Task 4"
```

### Step 3: åˆ›å»ºéªŒè¯æŠ¥å‘Šæ¨¡æ¿

**Files:**
- Create: `docs/plans/phase4-validation-report.md`

**æ–‡ä»¶å†…å®¹**:

```markdown
# Phase 4: å…³é”®è¯è§¦å‘æœºåˆ¶éªŒè¯æŠ¥å‘Š

**éªŒè¯æ—¥æœŸ**: [å¾…å¡«å†™]
**éªŒè¯è€…**: Claude Sonnet 4.5
**Phase**: 4 - å…³é”®è¯è§¦å‘æœºåˆ¶

---

## éªŒè¯æ‘˜è¦

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| æµ‹è¯•ç”¨ä¾‹æ€»æ•° | 10 |
| é€šè¿‡æ•° | [å¾…å¡«å†™] |
| å¤±è´¥æ•° | [å¾…å¡«å†™] |
| é€šè¿‡ç‡ | [å¾…å¡«å†™]% |
| é˜»å¡é—®é¢˜æ•° | 0 |

**æ€»ä½“çŠ¶æ€**: â¬œ å¾…éªŒè¯

---

## ä»»åŠ¡å®Œæˆæƒ…å†µ

### Task 1: /write å‘½ä»¤å…³é”®è¯æ£€æµ‹

**çŠ¶æ€**: â¬œ å¾…éªŒè¯

**ä¿®æ”¹æ–‡ä»¶**: templates/commands/write.md

**æ£€æŸ¥é¡¹**:
- [ ] Layer 3 ç« èŠ‚å·²æ·»åŠ 
- [ ] å…³é”®è¯æ‰«æé€»è¾‘å®Œæ•´
- [ ] èµ„æºå»é‡æ£€æŸ¥å®ç°
- [ ] ç”¨æˆ·ç¡®è®¤æµç¨‹ (Y/N/S)
- [ ] å®æ—¶è§¦å‘æœºåˆ¶
- [ ] é…ç½®ç¤ºä¾‹å®Œæ•´

**Git Commit**: [å¾…å¡«å†™]

---

### Task 2: /plan å‘½ä»¤å…³é”®è¯æ£€æµ‹

**çŠ¶æ€**: â¬œ å¾…éªŒè¯

**ä¿®æ”¹æ–‡ä»¶**: templates/commands/plan.md

**æ£€æŸ¥é¡¹**:
- [ ] Layer 3 ç« èŠ‚å·²æ·»åŠ 
- [ ] å¤ç”¨ /write é€»è¾‘
- [ ] é…ç½®æ§åˆ¶å®ç°

**Git Commit**: [å¾…å¡«å†™]

---

### Task 3: è¾…åŠ©å‘½ä»¤å…³é”®è¯æ£€æµ‹

**çŠ¶æ€**: â¬œ å¾…éªŒè¯

**ä¿®æ”¹æ–‡ä»¶**:
- templates/commands/analyze.md
- templates/commands/checklist.md

**æ£€æŸ¥é¡¹**:
- [ ] /analyze è½»é‡çº§è§¦å‘å®ç°
- [ ] /checklist æœ€è½»é‡çº§è§¦å‘å®ç°
- [ ] é…ç½®æ§åˆ¶ä¸€è‡´

**Git Commits**: [å¾…å¡«å†™]

---

### Task 4: æµ‹è¯•ç”¨ä¾‹å’ŒéªŒè¯

**çŠ¶æ€**: â¬œ å¾…éªŒè¯

**åˆ›å»ºæ–‡ä»¶**:
- docs/plans/phase4-test-cases.md
- docs/plans/phase4-validation-report.md

**æ£€æŸ¥é¡¹**:
- [ ] 10 ä¸ªæµ‹è¯•ç”¨ä¾‹å®šä¹‰
- [ ] éªŒæ”¶æ ‡å‡†æ˜ç¡®
- [ ] éªŒè¯æŠ¥å‘Šæ¨¡æ¿åˆ›å»º

**Git Commits**: [å¾…å¡«å†™]

---

## æµ‹è¯•ç”¨ä¾‹éªŒè¯ç»“æœ

### TC1: /write å‚æ•°å…³é”®è¯è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC2: /write ä»»åŠ¡æè¿°è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC3: è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC4: ç¦ç”¨å…³é”®è¯è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC5: èµ„æºå»é‡æ£€æŸ¥
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC6: é€‰æ‹©æ€§åŠ è½½ (S æ¨¡å¼)
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC7: /plan å‘½ä»¤è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC8: /analyze è½»é‡çº§è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC9: /checklist æœ€è½»é‡çº§è§¦å‘
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

### TC10: å®æ—¶è§¦å‘ï¼ˆäº¤äº’ä¸­ï¼‰
**çŠ¶æ€**: â¬œ å¾…æµ‹è¯•
**ç»“æœ**: [å¾…å¡«å†™]

---

## Git Commit å†å²

```bash
# [å¾…å¡«å†™æ‰§è¡Œåçš„å®é™… commit å†å²]
git log --oneline --since="2025-02-08" | grep "phase4\|Phase 4"
```

---

## å‘ç°çš„é—®é¢˜

### Issue 1: [å¾…å‘ç°]

**æè¿°**: [å¾…å¡«å†™]
**ä¸¥é‡ç¨‹åº¦**: [Critical/Important/Minor]
**ä¿®å¤çŠ¶æ€**: [å¾…ä¿®å¤/å·²ä¿®å¤]
**ä¿®å¤ Commit**: [å¾…å¡«å†™]

---

## éªŒæ”¶ç»“è®º

**Phase 4 æ˜¯å¦å®Œæˆ**: â¬œ å¾…ç¡®è®¤

**å®Œæˆæ ‡å‡†**:
- âœ… æ‰€æœ‰ 4 ä¸ªä»»åŠ¡å®Œæˆ
- âœ… æ‰€æœ‰ä¿®æ”¹å·²æäº¤ Git
- âœ… 10/10 æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… æ— é˜»å¡é—®é¢˜

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: [å¾…å¡«å†™]

---

## é™„å½•

### A. é…ç½®ç¤ºä¾‹éªŒè¯

**æœ€å°é…ç½®**ï¼ˆé»˜è®¤å¯ç”¨ï¼‰:
```yaml
# æ— éœ€é…ç½®ï¼Œkeyword-triggers é»˜è®¤å¯ç”¨
```

**å®Œå…¨ç¦ç”¨**:
```yaml
resource-loading:
  keyword-triggers:
    enabled: false
```

**è‡ªå®šä¹‰æ˜ å°„**:
```yaml
resource-loading:
  keyword-triggers:
    enabled: true
    custom-mappings:
      "ç”œåº¦": "knowledge-base/genres/romance.md"
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: [å¾…å¡«å†™]
**ç­¾å**: Claude Sonnet 4.5
```

### Step 4: æäº¤éªŒè¯æŠ¥å‘Šæ¨¡æ¿

```bash
git add docs/plans/phase4-validation-report.md
git commit -m "docs: åˆ›å»º Phase 4 éªŒè¯æŠ¥å‘Šæ¨¡æ¿

- ä»»åŠ¡å®Œæˆæ£€æŸ¥æ¸…å•
- æµ‹è¯•ç”¨ä¾‹éªŒè¯è®°å½•
- Git commit å†å²è¿½è¸ª
- é—®é¢˜å’Œä¿®å¤è®°å½•

Ref: Phase 4 Task 4"
```

---

## éªŒæ”¶æ ‡å‡†

### Phase 4 æ•´ä½“éªŒæ”¶

**ä»£ç ä¿®æ”¹**:
- âœ… templates/commands/write.md æ·»åŠ  Layer 3 å…³é”®è¯è§¦å‘ï¼ˆ~200 è¡Œï¼‰
- âœ… templates/commands/plan.md æ·»åŠ å…³é”®è¯è§¦å‘ï¼ˆ~50 è¡Œï¼‰
- âœ… templates/commands/analyze.md æ·»åŠ è½»é‡çº§è§¦å‘ï¼ˆ~30 è¡Œï¼‰
- âœ… templates/commands/checklist.md æ·»åŠ æœ€è½»é‡çº§è§¦å‘ï¼ˆ~20 è¡Œï¼‰

**æ–‡æ¡£åˆ›å»º**:
- âœ… docs/plans/phase4-test-cases.mdï¼ˆ10 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… docs/plans/phase4-validation-report.mdï¼ˆéªŒè¯æŠ¥å‘Šæ¨¡æ¿ï¼‰

**Git æäº¤**:
- âœ… è‡³å°‘ 6 æ¬¡æäº¤ï¼ˆ4 ä¸ªä»»åŠ¡ + 2 ä¸ªæ–‡æ¡£ï¼‰
- âœ… æäº¤ä¿¡æ¯éµå¾ªè§„èŒƒï¼ˆfeat/docs + Ref: Phase 4ï¼‰

**åŠŸèƒ½éªŒæ”¶**:
- âœ… å…³é”®è¯æ‰«æé€»è¾‘å®ç°ï¼ˆå‚æ•°ã€ä»»åŠ¡æè¿°ã€ç”¨æˆ·è¾“å…¥ï¼‰
- âœ… æ­£åˆ™åŒ¹é…å’Œä¼˜å…ˆçº§æ’åº
- âœ… èµ„æºå»é‡æ£€æŸ¥
- âœ… ç”¨æˆ·æç¤ºå’Œç¡®è®¤æµç¨‹ï¼ˆY/N/Sï¼‰
- âœ… åŠ¨æ€èµ„æºåŠ è½½
- âœ… é…ç½®æ§åˆ¶ï¼ˆenabled/custom-mappingsï¼‰
- âœ… å®æ—¶è§¦å‘æœºåˆ¶ï¼ˆå†™ä½œè¿‡ç¨‹ä¸­ï¼‰

**æµ‹è¯•è¦†ç›–**:
- âœ… 10/10 æµ‹è¯•ç”¨ä¾‹å®šä¹‰
- âœ… è¦†ç›–æ‰€æœ‰å…³é”®åŠŸèƒ½
- âœ… éªŒæ”¶æ ‡å‡†æ˜ç¡®

---

## ä¾èµ–å…³ç³»

**Phase 4 ä¾èµ–**:
- âœ… Phase 1 å®Œæˆï¼ˆkeyword-mappings.json å·²å­˜åœ¨ï¼‰
- âœ… Phase 2 å®Œæˆï¼ˆ/write å’Œ /plan å·²æœ‰èµ„æºåŠ è½½æœºåˆ¶ï¼‰
- âœ… Phase 3 å®Œæˆï¼ˆè¾…åŠ©å‘½ä»¤å·²æœ‰åŸºç¡€èµ„æºåŠ è½½ï¼‰

**Phase 4 äº§å‡ºä¾›åç»­ä½¿ç”¨**:
- Phase 5 æ–‡æ¡£ä¼˜åŒ–ï¼ˆéœ€è¦ Phase 4 çš„å®ç°ç»†èŠ‚ï¼‰

---

## æ³¨æ„äº‹é¡¹

1. **YAGNI åŸåˆ™**:
   - ä¸å®ç°è¿‡äºå¤æ‚çš„æ­£åˆ™åŒ¹é…å¼•æ“
   - ä¸æ·»åŠ æœºå™¨å­¦ä¹ å…³é”®è¯æ¨è
   - ä¿æŒç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…å³å¯

2. **DRY åŸåˆ™**:
   - /planã€/analyzeã€/checklist å¤ç”¨ /write çš„æ ¸å¿ƒé€»è¾‘
   - ä¸é‡å¤å®ç°å…³é”®è¯æ‰«æä»£ç 

3. **ç”¨æˆ·ä½“éªŒ**:
   - æç¤ºä¿¡æ¯æ¸…æ™°ç®€æ´
   - é»˜è®¤å¯ç”¨ï¼Œä¸å¼ºåˆ¶ç”¨æˆ·é…ç½®
   - èµ„æºå»é‡é¿å…éªšæ‰°ç”¨æˆ·

4. **æ€§èƒ½è€ƒè™‘**:
   - å…³é”®è¯åŒ¹é…ä½¿ç”¨é¢„ç¼–è¯‘æ­£åˆ™
   - é¿å…é‡å¤æ‰«æç›¸åŒæ–‡æœ¬
   - ç¼“å­˜å·²åŠ è½½èµ„æºåˆ—è¡¨

---

## å®æ–½å»ºè®®

**æ¨èæ‰§è¡Œé¡ºåº**:
1. Task 1ï¼ˆ/write æ ¸å¿ƒå®ç°ï¼‰- æœ€é‡è¦ï¼Œå…¶ä»–ä»»åŠ¡å¯å¤ç”¨
2. Task 4ï¼ˆæµ‹è¯•ç”¨ä¾‹ï¼‰- å°½æ—©å®šä¹‰ï¼Œè¾¹å®ç°è¾¹æµ‹è¯•
3. Task 2ï¼ˆ/planï¼‰- å¤ç”¨ Task 1 é€»è¾‘
4. Task 3ï¼ˆè¾…åŠ©å‘½ä»¤ï¼‰- è½»é‡çº§å®ç°

**é¢„ä¼°æ—¶é—´åˆ†é…**:
- Task 1: 3-4hï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
- Task 2: 1-2hï¼ˆå¤ç”¨ï¼‰
- Task 3: 1-2hï¼ˆè½»é‡çº§ï¼‰
- Task 4: 1hï¼ˆæ–‡æ¡£ï¼‰
- **æ€»è®¡**: 6-9h

**å¹¶è¡Œæ‰§è¡Œå»ºè®®**:
- Task 1 å’Œ Task 4 å¯å¹¶è¡Œï¼ˆè¾¹å†™ä»£ç è¾¹å†™æµ‹è¯•ï¼‰
- Task 2 å’Œ Task 3 å¿…é¡»ç­‰ Task 1 å®Œæˆ

---

## é™„å½•ï¼šå…³é”®è¯æ˜ å°„è¡¨ç¤ºä¾‹

**å†…ç½®æ˜ å°„**ï¼ˆå·²å­˜åœ¨äº templates/config/keyword-mappings.jsonï¼‰:
```json
{
  "mappings": {
    "craft-knowledge": {
      "pacing": {
        "keywords": ["èŠ‚å¥", "æ‹–æ²“", "å¤ªå¿«", "å¤ªæ…¢"],
        "resources": [
          "templates/knowledge-base/craft/pacing.md",
          "templates/skills/writing-techniques/pacing-control/SKILL.md"
        ],
        "priority": 1
      }
    }
  },
  "regex-patterns": {
    "pacing": "èŠ‚å¥|æ‹–æ²“|å¤ªå¿«|å¤ªæ…¢|è¿‡å¿«|è¿‡æ…¢"
  }
}
```

**è‡ªå®šä¹‰æ˜ å°„**ï¼ˆåœ¨ specification.md ä¸­é…ç½®ï¼‰:
```yaml
resource-loading:
  keyword-triggers:
    custom-mappings:
      "ç”œåº¦": "knowledge-base/genres/romance.md"
      "è™æ–‡": "knowledge-base/requirements/romance-angst.md"
```

---

**è®¡åˆ’åˆ›å»ºæ—¶é—´**: 2025-02-08
**è®¡åˆ’ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… è®¡åˆ’å®Œæˆï¼Œç­‰å¾…æ‰§è¡Œ
