# Task 37: `/relations` 内容补全

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** 补全 `/relations` 命令的模板内容，使其能完整管理角色关系：关系图谱可视化、关系变化追踪、关系冲突检测

**Architecture:** 完善 `templates/commands/relations.md` 的执行流程和输出格式。

**Tech Stack:** Markdown 模板

---

### Task 37.1: 读取现有 relations.md 并评估缺失内容

**Files:**
- Read: `templates/commands/relations.md`

**Step 1: 读取文件，记录已有内容和缺失部分**

需要确认以下能力是否已实现：
- [ ] 关系图谱初始化
- [ ] 关系可视化输出（文本图谱）
- [ ] 关系变化追踪（随章节演变）
- [ ] 关系冲突检测
- [ ] 关系强度评估

---

### Task 37.2: 补全关系图谱可视化

**Files:**
- Modify: `templates/commands/relations.md`

**Step 1: 添加关系图谱可视化输出格式**

```markdown
#### 关系图谱可视化

##### 全局关系图

```
👥 角色关系图谱
━━━━━━━━━━━━━━━━━━━━

                    [师父]
                   ╱      ╲
              师徒/         \师徒
                ╱             ╲
          [主角] ←── 暗恋 ── [师姐]
            │ ╲               │
          仇敌  同门           │
            │    ╲           同门
            ↓     ╲           │
         [反派]    [师弟] ── [师妹]
            │                  │
          主从                朋友
            │                  │
         [手下A]           [城主之女]
```

##### 关系列表视图

```
👥 关系详情
━━━━━━━━━━━━━━━━━━━━

[主角] 的关系：
  ├─ [师父]    ：师徒 ★★★★★ （尊敬、信任）
  ├─ [师姐]    ：同门 ★★★★☆ （好感、暗恋）→ 变化中
  ├─ [师弟]    ：同门 ★★★☆☆ （友好、竞争）
  ├─ [反派]    ：仇敌 ★★★★★ （仇恨、警惕）
  └─ [城主之女]：朋友 ★★☆☆☆ （初识、好奇）

关系强度说明：★ = 关系深度/重要性（1-5）
```

##### 阵营视图

```
👥 阵营关系
━━━━━━━━━━━━━━━━━━━━

🟢 主角阵营：
  [主角]、[师父]、[师姐]、[师弟]、[城主之女]

🔴 反派阵营：
  [反派]、[手下A]、[手下B]

🟡 中立/未定：
  [神秘人]、[商人]

阵营关系：
  主角阵营 ←→ 反派阵营：敌对
  主角阵营 ←→ 中立：友好（但[神秘人]立场不明）
```

---

### Task 37.3: 补全关系变化追踪

**Files:**
- Modify: `templates/commands/relations.md`

**Step 1: 添加关系变化追踪**

```markdown
#### 关系变化追踪

##### 关系演变时间线

```
📈 关系演变 — [主角] ↔ [师姐]
━━━━━━━━━━━━━━━━━━━━

第 1 章  ：初识（陌生）     ★☆☆☆☆
第 3 章  ：指导修炼（好感） ★★☆☆☆  ↑
第 8 章  ：并肩战斗（信任） ★★★☆☆  ↑
第 12 章 ：误会（疏远）     ★★☆☆☆  ↓
第 15 章 ：误会解除（亲近） ★★★★☆  ↑↑
第 20 章 ：生死相依（深厚） ★★★★★  ↑

趋势：稳步上升（中间有一次波折，符合「先抑后扬」模式）
```

##### 关系变化汇总

```
📊 最近 5 章关系变化
━━━━━━━━━━━━━━━━━━━━

| 关系 | 变化前 | 变化后 | 触发事件 | 章节 |
|------|--------|--------|---------|------|
| 主角↔师姐 | ★★★☆ | ★★★★ | 并肩战斗 | 第 18 章 |
| 主角↔反派 | ★★★★ | ★★★★★ | 反派伤害师姐 | 第 19 章 |
| 师弟↔师妹 | ★★☆☆ | ★★★☆ | 共同修炼 | 第 20 章 |

⚠️ 长期未变化的关系：
- 主角↔城主之女：已 10 章未有互动，关系停滞
  → 建议：安排互动场景，或确认此关系是否需要发展
```

---

### Task 37.4: 补全关系冲突检测

**Files:**
- Modify: `templates/commands/relations.md`

**Step 1: 添加关系冲突检测**

```markdown
#### 关系冲突检测

检测关系描写中的不一致：

| 冲突类型 | 描述 |
|---------|------|
| 态度矛盾 | 设定为仇敌，但对话中表现友好 |
| 称呼不一致 | 同一关系在不同章节使用不同称呼 |
| 关系跳跃 | 关系突然变化，缺少过渡 |
| 单向矛盾 | A 对 B 的态度与 B 对 A 的态度不匹配（非刻意设计时） |

##### 冲突报告

```
⚠️ 关系冲突检测
━━━━━━━━━━━━━━━━━━━━

🔴 严重冲突：
1. 关系跳跃：主角↔师弟
   第 10 章：关系紧张（争吵）
   第 11 章：亲密无间（称兄道弟）
   → 缺少和解过渡，建议补充

⚠️ 轻微冲突：
2. 称呼不一致：主角对师姐
   第 5 章：「师姐」
   第 12 章：「小雪」（未交代何时改口）
   → 建议在某章节自然过渡称呼变化
```
```

**Step 2: Commit**

```bash
git add templates/commands/relations.md
git commit -m "feat(relations): complete relationship visualization, evolution tracking, and conflict detection"
```
