# Task 2: `/write` å AI è§„èŒƒæ•°æ®å¤–ç½®

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** å°† `write.md` ä¸­çš„ç¦ç”¨è¯é»‘åå•å’Œæ›¿æ¢ç­–ç•¥è¡¨ç§»è‡³ `anti-ai-v4.md`ï¼ˆå»é‡åˆå¹¶ï¼‰ï¼Œä¿ç•™æ®µè½ç»“æ„è§„èŒƒå’Œè‡ªç„¶åŒ–å†™ä½œåŸåˆ™åœ¨ `write.md` ä¸­

**Architecture:** `write.md` ä¸­çš„å AI æ•°æ®ï¼ˆç¦ç”¨è¯é»‘åå• ~768-772 è¡Œã€æ›¿æ¢ç­–ç•¥è¡¨ ~774-782 è¡Œï¼‰ä¸ `anti-ai-v4.md` å­˜åœ¨å¤§é‡é‡å¤ã€‚å°† `write.md` ä¸­çš„æ•°æ®éƒ¨åˆ†æ›¿æ¢ä¸ºå¼•ç”¨æŒ‡ä»¤ï¼ŒæŒ‡å‘ `anti-ai-v4.md`ã€‚`anti-ai-v4.md` å·²åŒ…å«å®Œæ•´çš„ 200+ ç¦ç”¨è¯å’Œæ›¿æ¢è¡¨ï¼Œæ— éœ€é¢å¤–æ·»åŠ ã€‚

**Tech Stack:** Markdown æ¨¡æ¿

---

### Task 2.1: åˆ†æ write.md ä¸­éœ€è¦å¤–ç½®çš„å†…å®¹

**Files:**
- Read: `templates/commands/write.md:758-790`
- Read: `templates/knowledge-base/requirements/anti-ai-v4.md`

**Step 1: ç¡®è®¤ write.md ä¸­çš„æ•°æ®éƒ¨åˆ†è¾¹ç•Œ**

éœ€è¦å¤–ç½®çš„å†…å®¹ï¼ˆ`write.md` ç¬¬ 768-782 è¡Œï¼‰ï¼š

```markdown
**AIé«˜é¢‘è¯é»‘åå•**ï¼š
- "å”¯ä¸€çš„"ã€"ç›´åˆ°"ã€"å¼¥æ¼«ç€"ã€"æ‘‡æ‘‡æ¬²å "
- "ç©ºæ°”å‡å›º"ã€"è¯éŸ³æœªè½"ã€"çŒ›åœ°"
- "ä¸ç¦"ã€"é¡¿æ—¶"ã€"å¿ƒä¸­æš—æƒ³"
- "çš±èµ·çœ‰å¤´"ã€"å¹äº†å£æ°”"

**æ›¿æ¢ç­–ç•¥**ï¼š
| âŒ AIè¯æ±‡ | âœ… è‡ªç„¶æ›¿æ¢ |
|---------|----------|
| å¼¥æ¼«ç€éœ‰å‘³ | æœ‰è‚¡éœ‰å‘³ |
| å”¯ä¸€çš„å…‰æº | åªæœ‰ä¸€ç‚¹å…‰ |
| æ‘‡æ‘‡æ¬²å çš„æœ¨æ¡Œ | ä¸€å¼ æ—§æœ¨æ¡Œ |
| ä»–å¿ƒä¸­æš—æƒ³ | ä»–æƒ³ / åˆ é™¤ |
| è¯éŸ³æœªè½ | ä»–è¯æ²¡è¯´å®Œ / åˆ é™¤ |
```

éœ€è¦ä¿ç•™çš„å†…å®¹ï¼ˆ`write.md` ç¬¬ 758-767 è¡Œçš„è‡ªæ£€æ¸…å•ã€ç¬¬ 697-757 è¡Œçš„æ®µè½ç»“æ„è§„èŒƒå’Œè‡ªç„¶åŒ–å†™ä½œåŸåˆ™ï¼‰ï¼š
- âœ… ä¿ç•™ï¼šæ®µè½ç»“æ„è§„èŒƒï¼ˆç¬¬ 697-715 è¡Œï¼‰
- âœ… ä¿ç•™ï¼šç¦æ­¢äº‹é¡¹æ¸…å•ï¼ˆç¬¬ 716-737 è¡Œï¼‰
- âœ… ä¿ç•™ï¼šè‡ªç„¶åŒ–å†™ä½œåŸåˆ™ï¼ˆç¬¬ 739-757 è¡Œï¼‰
- âœ… ä¿ç•™ï¼šè‡ªæ£€æ ‡å‡†ï¼ˆç¬¬ 758-767 è¡Œï¼‰

**Step 2: ç¡®è®¤ anti-ai-v4.md å·²è¦†ç›–è¿™äº›æ•°æ®**

æ£€æŸ¥ `anti-ai-v4.md` æ˜¯å¦å·²åŒ…å«ï¼š
- âœ… ç¬¬ä¸€å±‚ï¼šç¦ç”¨è¯æ±‡è¡¨ï¼ˆ200+ è¯ï¼‰â€” å®Œå…¨è¦†ç›– write.md çš„é»‘åå•
- âœ… æ›¿æ¢ç­–ç•¥è¡¨ â€” å®Œå…¨è¦†ç›– write.md çš„æ›¿æ¢ç­–ç•¥
- âœ… ç¬¬äºŒå±‚ï¼šç¦æ­¢å¥å¼ â€” é¢å¤–å†…å®¹
- âœ… ç¬¬ä¸‰å±‚ï¼šå½¢å®¹è¯é™åˆ¶ â€” é¢å¤–å†…å®¹
- âœ… ç¬¬å››å±‚ï¼šæˆè¯­å…¨é¢ç¦ç”¨ â€” é¢å¤–å†…å®¹
- âœ… ç¬¬äº”å±‚ï¼šå¯¹è¯å»AIåŒ– â€” é¢å¤–å†…å®¹
- âœ… ç¬¬å…­å±‚ï¼šæ®µè½ç»“æ„é™åˆ¶ â€” é¢å¤–å†…å®¹
- âœ… ç¬¬ä¸ƒå±‚ï¼šæ ‡ç‚¹å»AIåŒ– â€” é¢å¤–å†…å®¹

Expected: `anti-ai-v4.md` å®Œå…¨è¦†ç›– `write.md` ä¸­çš„æ•°æ®éƒ¨åˆ†ï¼Œä¸”å†…å®¹æ›´ä¸°å¯Œ

---

### Task 2.2: æ›¿æ¢ write.md ä¸­çš„æ•°æ®éƒ¨åˆ†ä¸ºå¼•ç”¨æŒ‡ä»¤

**Files:**
- Modify: `templates/commands/write.md:768-782`

**Step 1: å°†ç¬¬ 768-782 è¡Œçš„ç¦ç”¨è¯é»‘åå•å’Œæ›¿æ¢ç­–ç•¥è¡¨æ›¿æ¢ä¸ºå¼•ç”¨æŒ‡ä»¤**

å°†åŸå†…å®¹ï¼š
```markdown
**AIé«˜é¢‘è¯é»‘åå•**ï¼š
- "å”¯ä¸€çš„"ã€"ç›´åˆ°"ã€"å¼¥æ¼«ç€"ã€"æ‘‡æ‘‡æ¬²å "
- "ç©ºæ°”å‡å›º"ã€"è¯éŸ³æœªè½"ã€"çŒ›åœ°"
- "ä¸ç¦"ã€"é¡¿æ—¶"ã€"å¿ƒä¸­æš—æƒ³"
- "çš±èµ·çœ‰å¤´"ã€"å¹äº†å£æ°”"

**æ›¿æ¢ç­–ç•¥**ï¼š
| âŒ AIè¯æ±‡ | âœ… è‡ªç„¶æ›¿æ¢ |
|---------|----------|
| å¼¥æ¼«ç€éœ‰å‘³ | æœ‰è‚¡éœ‰å‘³ |
| å”¯ä¸€çš„å…‰æº | åªæœ‰ä¸€ç‚¹å…‰ |
| æ‘‡æ‘‡æ¬²å çš„æœ¨æ¡Œ | ä¸€å¼ æ—§æœ¨æ¡Œ |
| ä»–å¿ƒä¸­æš—æƒ³ | ä»–æƒ³ / åˆ é™¤ |
| è¯éŸ³æœªè½ | ä»–è¯æ²¡è¯´å®Œ / åˆ é™¤ |
```

æ›¿æ¢ä¸ºï¼š
```markdown
**ğŸ“‹ ç¦ç”¨è¯ä¸æ›¿æ¢ç­–ç•¥**ï¼š

> **å¼•ç”¨å¤–éƒ¨è§„èŒƒ**ï¼šå®Œæ•´çš„ç¦ç”¨è¯é»‘åå•ï¼ˆ200+ è¯ï¼‰å’Œæ›¿æ¢ç­–ç•¥è¡¨ï¼Œè¯·å‚é˜…ï¼š
> `templates/knowledge-base/requirements/anti-ai-v4.md`
>
> è¯¥æ–‡ä»¶åŒ…å« 7 å±‚å» AI è§„èŒƒï¼š
> 1. ç¦ç”¨è¯æ±‡è¡¨ï¼ˆæƒ…ç»ªç±»ã€åŠ¨ä½œç±»ã€ç¨‹åº¦ç±»ã€è½¬æŠ˜ç±»ã€æå†™ç±»ï¼‰
> 2. ç¦æ­¢å¥å¼ï¼ˆ"ç„¶è€Œ"å¼€å¤´ã€"æ®Šä¸çŸ¥"ä¸Šå¸è§†è§’ã€"åœ¨...ä¸‹"çŠ¶è¯­ç­‰ï¼‰
> 3. å½¢å®¹è¯é™åˆ¶ï¼ˆæ¯100å­—æœ€å¤š3ä¸ªï¼‰
> 4. æˆè¯­å…¨é¢ç¦ç”¨
> 5. å¯¹è¯å»AIåŒ–
> 6. æ®µè½ç»“æ„é™åˆ¶
> 7. æ ‡ç‚¹å»AIåŒ–
>
> âš ï¸ **å†™ä½œæ—¶å¿…é¡»åŠ è½½æ­¤æ–‡ä»¶**ï¼Œä½œä¸ºç¦ç”¨è¯å’Œæ›¿æ¢çš„æƒå¨å‚è€ƒã€‚

**å¿«é€Ÿè®°å¿†**ï¼ˆæœ€å¸¸è§çš„ AI é«˜é¢‘è¯ï¼Œå®Œæ•´åˆ—è¡¨è§ä¸Šè¿°æ–‡ä»¶ï¼‰ï¼š
- ç¦ç”¨ï¼šç„¶è€Œã€æ®Šä¸çŸ¥ã€ç¼“ç¼“ã€æ·±é‚ƒã€ä»¿ä½›...ä¸€èˆ¬
- åŸåˆ™ï¼šçŸ­å¥ä¼˜å…ˆã€ç™½è¯æ›¿ä»£ã€åˆ é™¤è£…é¥°æ€§å½¢å®¹è¯
```

**Step 2: éªŒè¯ä¿®æ”¹**

Run: `grep -n "å¼•ç”¨å¤–éƒ¨è§„èŒƒ\|anti-ai-v4.md\|å¿«é€Ÿè®°å¿†" templates/commands/write.md`
Expected: åœ¨åŸæ¥ç¬¬ 768 è¡Œé™„è¿‘çœ‹åˆ°æ–°å†…å®¹

**Step 3: Commit**

```bash
git add templates/commands/write.md
git commit -m "refactor(write): externalize anti-AI word lists to anti-ai-v4.md, keep structural rules inline"
```

---

### Task 2.3: æ›´æ–° write.md æŸ¥è¯¢åè®®ï¼Œç¡®ä¿ anti-ai-v4.md è¢«è‡ªåŠ¨åŠ è½½

**Files:**
- Modify: `templates/commands/write.md:583-592`ï¼ˆæŸ¥è¯¢åè®®ç¬¬ 5 æ­¥ã€Œå†æŸ¥ï¼ˆå†™ä½œè§„èŒƒï¼‰ã€ï¼‰

**Step 1: ç¡®è®¤æŸ¥è¯¢åè®®ç¬¬ 5 æ­¥å·²åŒ…å« anti-ai-v4.md çš„åŠ è½½**

æ£€æŸ¥ `write.md` ç¬¬ 583-592 è¡Œé™„è¿‘çš„ã€Œå†æŸ¥ï¼ˆå†™ä½œè§„èŒƒï¼‰ã€éƒ¨åˆ†ã€‚

å¦‚æœå°šæœªæ˜ç¡®åˆ—å‡º `anti-ai-v4.md`ï¼Œåœ¨è¯¥éƒ¨åˆ†æ·»åŠ ï¼š

```markdown
5. **å†æŸ¥ï¼ˆå†™ä½œè§„èŒƒï¼‰**ï¼š
   - `stories/*/specification.md` ä¸­é…ç½®çš„å†™ä½œé£æ ¼æ–‡ä»¶
   - `stories/*/specification.md` ä¸­é…ç½®çš„å†™ä½œè§„èŒƒæ–‡ä»¶
   - **âš ï¸ å¿…é¡»åŠ è½½**ï¼š`templates/knowledge-base/requirements/anti-ai-v4.md`ï¼ˆç¦ç”¨è¯ä¸æ›¿æ¢ç­–ç•¥æƒå¨å‚è€ƒï¼‰
```

**Step 2: éªŒè¯ä¿®æ”¹**

Run: `grep -n "anti-ai-v4" templates/commands/write.md`
Expected: è‡³å°‘åœ¨ 2 å¤„å‡ºç°ï¼ˆæŸ¥è¯¢åè®® + å¼•ç”¨æŒ‡ä»¤ï¼‰

**Step 3: Commit**

```bash
git add templates/commands/write.md
git commit -m "feat(write): ensure anti-ai-v4.md is loaded in query protocol step 5"
```

---

### Task 2.4: éªŒè¯å»é‡å®Œæ•´æ€§

**Step 1: å¯¹æ¯”ç¡®è®¤æ— é—æ¼**

æ£€æŸ¥ `write.md` ä¸­æ˜¯å¦è¿˜æœ‰å…¶ä»–å†…è”çš„ç¦ç”¨è¯æ•°æ®ï¼ˆé™¤äº†ã€Œå¿«é€Ÿè®°å¿†ã€æ‘˜è¦å¤–ï¼‰ï¼š

Run: `grep -n "å¼¥æ¼«\|æ‘‡æ‘‡æ¬²å \|å¿ƒä¸­æš—æƒ³\|è¯éŸ³æœªè½" templates/commands/write.md`
Expected: ä»…åœ¨ã€Œå¿«é€Ÿè®°å¿†ã€æ‘˜è¦ä¸­å‡ºç°ï¼Œä¸å†æœ‰å®Œæ•´çš„è¡¨æ ¼æ•°æ®

**Step 2: ç¡®è®¤ anti-ai-v4.md æœªè¢«ä¿®æ”¹**

Run: `git diff templates/knowledge-base/requirements/anti-ai-v4.md`
Expected: æ— å˜æ›´ï¼ˆanti-ai-v4.md å·²ç»è¶³å¤Ÿå®Œæ•´ï¼Œæ— éœ€ä¿®æ”¹ï¼‰

**Step 3: æœ€ç»ˆ Commit**

```bash
git log --oneline -4
```
Expected: çœ‹åˆ° 2-3 ä¸ªç›¸å…³ commit
