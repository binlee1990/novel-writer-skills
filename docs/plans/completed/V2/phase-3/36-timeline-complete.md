# Task 36: `/timeline` 内容补全

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** 补全 `/timeline` 命令的模板内容，使其能完整管理故事时间线：时间线可视化、时间冲突检测、多线程时间对齐

**Architecture:** 完善 `templates/commands/timeline.md` 的执行流程和输出格式。

**Tech Stack:** Markdown 模板

---

### Task 36.1: 读取现有 timeline.md 并评估缺失内容

**Files:**
- Read: `templates/commands/timeline.md`

**Step 1: 读取文件，记录已有内容和缺失部分**

需要确认以下能力是否已实现：
- [ ] 时间线初始化（从 specification 提取时间节点）
- [ ] 章节时间标注（每章发生的时间范围）
- [ ] 时间线可视化输出
- [ ] 时间冲突检测
- [ ] 多叙事线时间对齐
- [ ] 时间跳跃标注

---

### Task 36.2: 补全时间线可视化

**Files:**
- Modify: `templates/commands/timeline.md`

**Step 1: 添加时间线可视化输出格式**

```markdown
#### 时间线可视化

```
📅 故事时间线
━━━━━━━━━━━━━━━━━━━━

[年份/日期]  [事件]                    [章节]
─────────────────────────────────────────────
第 1 天      主角入学                   第 1 章
  │
第 1 天      遇到师姐                   第 1 章
  │
第 3 天      第一次修炼                 第 2 章
  │
第 7 天      突破练气一层               第 3 章
  ┊ (跳跃：20 天)
第 27 天     参加门派考核               第 4 章
  │
第 27 天     与反派初次冲突             第 4 章
  │
第 30 天     外出历练                   第 5 章
  ┊ (跳跃：60 天)
第 90 天     历练归来                   第 8 章
```

##### 多线程时间对齐视图

```
📅 多线程时间线
━━━━━━━━━━━━━━━━━━━━

时间        主线（主角）      支线1（角色B）    支线2（角色C）
──────────────────────────────────────────────────────────
第 1 天     入学 [ch1]        —                 —
第 3 天     修炼 [ch2]        —                 —
第 7 天     突破 [ch3]        出发 [ch4]        —
第 15 天    —                 到达 [ch5]        接到任务 [ch6]
第 20 天    考核 [ch7]        调查 [ch8]        出发 [ch9]
第 27 天    冲突 [ch10]       发现线索 [ch11]   ★ 与主角相遇 [ch10]
```
```

---

### Task 36.3: 补全时间冲突检测

**Files:**
- Modify: `templates/commands/timeline.md`

**Step 1: 添加时间冲突检测逻辑**

```markdown
#### 时间冲突检测

自动检测以下类型的时间冲突：

| 冲突类型 | 描述 | 示例 |
|---------|------|------|
| 顺序冲突 | 事件 A 应在事件 B 之前，但章节顺序相反 | 第 5 章写「三天后」，第 6 章写「昨天」 |
| 并行冲突 | 同一角色同一时间出现在两个地点 | 角色A 在第 10 章（第 5 天）在城东，第 11 章（第 5 天）在城西 |
| 持续冲突 | 事件持续时间与描述不符 | 「三天的旅程」但只写了一个场景 |
| 跳跃冲突 | 时间跳跃期间有未交代的事件 | 跳过 30 天，但期间应有门派考核 |
| 年龄冲突 | 角色年龄与时间线不符 | 开篇 16 岁，一年后仍写 16 岁 |

##### 冲突报告格式

```
⚠️ 时间冲突检测
━━━━━━━━━━━━━━━━━━━━

🔴 严重冲突：
1. 并行冲突：角色A 在第 5 天同时出现在两个地点
   - 第 10 章：角色A 在城东战斗
   - 第 11 章：角色A 在城西购物（同一天）
   → 建议：调整第 11 章时间为第 6 天

⚠️ 轻微冲突：
2. 持续冲突：第 5-8 章描述「三天旅程」，但内容只覆盖 1 天
   → 建议：补充旅途中的场景，或缩短旅程时间

💡 提示：
3. 时间跳跃：第 8-9 章之间跳过 60 天
   → 确认：这 60 天内是否有需要交代的事件？
```
```

**Step 2: Commit**

```bash
git add templates/commands/timeline.md
git commit -m "feat(timeline): complete timeline visualization, multi-thread alignment, and conflict detection"
```
