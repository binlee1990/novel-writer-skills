# Task 32: 风格一致性引擎增强

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** 增强 `style-detector` Skill，新增风格基线建立、风格偏移检测、跨章节风格一致性评分

**Architecture:** 在 `templates/skills/writing-techniques/style-detector/SKILL.md` 中扩展能力。核心思路：先从前 5 章建立「风格基线」，后续章节与基线对比检测偏移。

**Tech Stack:** Markdown Skill 模板

---

### Task 32.1: 在 SKILL.md 中添加风格基线与偏移检测

**Files:**
- Modify: `templates/skills/writing-techniques/style-detector/SKILL.md`

**Step 1: 在现有能力之后添加扩展章节**

```markdown

---

## 扩展能力

### 扩展 1：风格基线建立

**从已写章节中提取风格基线**，作为后续一致性检测的参照。

#### 基线提取维度

| 维度 | 指标 | 提取方法 |
|------|------|---------|
| 句式 | 平均句长、长短句比例、句式多样性 | 统计分析 |
| 词汇 | 常用词频、词汇丰富度、专业术语密度 | 词频统计 |
| 修辞 | 比喻/拟人/排比等修辞手法的使用频率 | 模式识别 |
| 叙述 | 叙述/对话/描写/动作的比例 | 段落分类统计 |
| 节奏 | 段落长度分布、场景切换频率 | 结构分析 |
| 视角 | 叙述人称、视角距离（远/近/内心） | 文本分析 |

#### 基线建立流程

1. 选取「代表性章节」（默认前 5 章，或用户指定）
2. 对每个维度提取数值
3. 计算均值和标准差
4. 生成风格基线报告

#### 基线报告格式

```
📊 风格基线报告
━━━━━━━━━━━━━━━━━━━━
基线来源：第 1-5 章

句式特征：
  平均句长：18 字/句
  长句（>30字）占比：15%
  短句（<10字）占比：25%
  句式多样性：7/10

词汇特征：
  词汇丰富度：6/10
  口语化程度：中高
  专业术语密度：低

叙述构成：
  对话：35%  ████████░░
  描写：25%  ██████░░░░
  叙述：20%  █████░░░░░
  动作：20%  █████░░░░░

修辞频率：
  比喻：每千字 1.2 次
  排比：每千字 0.3 次
  其他：每千字 0.5 次

节奏特征：
  平均段落长度：120 字
  场景切换频率：每章 4-6 次
```

### 扩展 2：风格偏移检测

**将新章节与风格基线对比，检测偏移**：

#### 偏移检测规则

| 偏移程度 | 判定标准 | 级别 |
|---------|---------|------|
| 正常波动 | 在基线 ±1 标准差内 | ✅ |
| 轻微偏移 | 在基线 ±1-2 标准差 | ⚠️ 提示 |
| 显著偏移 | 超出基线 ±2 标准差 | 🔴 警告 |

#### 偏移报告格式

```
📊 风格偏移检测 — 第 [N] 章
━━━━━━━━━━━━━━━━━━━━

| 维度 | 基线值 | 本章值 | 偏移 | 状态 |
|------|--------|--------|------|------|
| 平均句长 | 18字 | 22字 | +22% | ⚠️ 偏长 |
| 对话占比 | 35% | 50% | +43% | 🔴 偏高 |
| 描写占比 | 25% | 10% | -60% | 🔴 偏低 |
| 比喻频率 | 1.2/千字 | 1.0/千字 | -17% | ✅ 正常 |
| 段落长度 | 120字 | 130字 | +8% | ✅ 正常 |

🔴 显著偏移：
- 对话占比从 35% 升至 50%，描写占比从 25% 降至 10%
  可能原因：本章为纯对话场景
  建议：如非刻意为之，增加环境描写和动作描写

⚠️ 轻微偏移：
- 平均句长偏长，可能影响阅读节奏
  建议：适当拆分长句
```

### 扩展 3：跨章节风格一致性评分

**对多章节进行整体风格一致性评估**：

#### 评分维度

```
📊 风格一致性评分（第 1-[N] 章）
━━━━━━━━━━━━━━━━━━━━

句式一致性：████████░░ 8/10
词汇一致性：███████░░░ 7/10
叙述构成  ：██████░░░░ 6/10 ⚠️
修辞风格  ：████████░░ 8/10
节奏一致性：█████████░ 9/10

综合评分：7.6/10

📈 趋势：
第 1-10 章：稳定（基线建立期）
第 11-15 章：轻微偏移（对话增多）
第 16-20 章：回归基线
第 21-25 章：⚠️ 显著偏移（描写风格变化）

💡 建议：
- 第 21-25 章的描写风格与前期不同，检查是否为刻意变化
- 如非刻意，参考第 1-10 章的描写风格进行调整
```
```

**Step 2: Commit**

```bash
git add templates/skills/writing-techniques/style-detector/SKILL.md
git commit -m "feat(skill): enhance style-detector with baseline establishment, drift detection, cross-chapter consistency scoring"
```
