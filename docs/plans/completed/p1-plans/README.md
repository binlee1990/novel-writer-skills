# P1 优先级实现计划文档目录

本目录包含 P1 优先级任务的详细实现计划文档。

---

## 📋 P1 优先级任务（已规划）

P1 任务是核心体验的关键提升，直接影响用户的创作效率和项目生态发展。

### 任务清单

| # | 任务名称 | 计划文档 | 预估工时 | 状态 | 优先级理由 |
|---|---------|---------|---------|------|-----------|
| 1 | /recap 上下文重建命令 | [2025-02-06-recap-command.md](2025-02-06-recap-command.md) | 7-9h | 📝 已规划 | 直击"30章后失焦"核心痛点 |
| 2 | 测试体系 | [2025-02-06-test-infrastructure.md](2025-02-06-test-infrastructure.md) | 18-25h | 📝 已规划 | 项目可维护性的基础 |
| 3 | 插件远程安装 | [2025-02-06-remote-plugin-installation.md](2025-02-06-remote-plugin-installation.md) | 17-25h | 📝 已规划 | 生态化的前提条件 |

**P1 总计：**
- **任务数量：** 3 项
- **预估总工时：** 42-59 小时
- **完成状态：** 0/3 已实现，3/3 已规划

---

## 🎯 任务详情

### 1. /recap 上下文重建命令

**核心价值：** 解决长篇创作最大痛点

**问题场景：**
- 隔天/隔周续写时，完全忘记故事状态
- 写到 30+ 章后，AI 和作者都开始失焦
- 需要花大量时间回顾前文

**解决方案：**
- 自动汇总角色状态、情节进展、未解决伏笔
- 智能优先级排序（超期伏笔、长期未出现角色）
- 8 部分结构化简报（5 分钟内完全刷新记忆）
- 与 tracking 系统深度集成

**输出：**
```
📋 上下文简报
├── 角色当前状态 🎭
├── 主线情节进展 📖
├── 未解决的伏笔与悬念 🔍
├── 角色关系网络 💞
├── 上一章回顾 📄
├── 时间线快照 ⏰
├── 创作状态检查 ✅
└── 快速参考卡片 🎯
```

**成功标准：**
- 用户："5 分钟就能想起所有关键信息"
- 信息准确率 > 95%
- 警告召回率 > 90%

---

### 2. 测试体系

**核心价值：** 项目质量和可维护性的基石

**当前状态：**
- ❌ 测试覆盖率：0%
- ❌ 无测试框架
- ❌ 无 CI/CD

**解决方案：**
- Jest + ts-jest 测试框架
- 单元测试（utils, plugins, version）
- 集成测试（CLI 命令、插件系统）
- E2E 测试（完整工作流）
- 模板文件验证
- GitHub Actions CI/CD

**测试结构：**
```
tests/
├── unit/           # 单元测试（20+ 用例）
├── integration/    # 集成测试（15+ 用例）
├── e2e/            # 端到端测试（5+ 用例）
├── fixtures/       # 测试数据
└── helpers/        # 测试工具
```

**目标：**
- 覆盖率 ≥ 70%
- 所有 PR 必须通过测试
- 回归问题零容忍

**价值：**
- 重构有信心
- PR Review 有标准
- 质量有保障

---

### 3. 插件远程安装

**核心价值：** 开启插件生态化

**当前状态：**
- ✅ 本地插件系统
- ❌ 远程安装（src/plugins/manager.ts:222 明确标注 TODO）
- ❌ 版本管理
- ❌ 依赖解析

**解决方案：**
- 支持 npm registry 安装
- 支持 GitHub 安装
- 插件标识符解析（`@scope/name@version`, `user/repo`）
- 版本管理和依赖解析
- plugins.json 注册表
- 插件验证和安全检查

**使用示例：**
```bash
# 从 npm 安装
novelwrite plugin:add @novelwrite/translate

# 从 GitHub 安装
novelwrite plugin:add username/my-plugin

# 指定版本
novelwrite plugin:add @novelwrite/translate@1.2.0

# 更新插件
novelwrite plugin:update translate

# 搜索插件
novelwrite plugin:search export
```

**架构：**
```
PluginManager
├── NpmInstaller    # npm registry 安装
├── GitHubInstaller # GitHub 安装
├── Validator       # 插件验证
└── Registry        # plugins.json 管理
```

**成功标准：**
- 一键安装成功率 ≥ 95%
- 自动依赖解析
- 为第三方插件开发者打开大门

---

## 📊 执行优先级建议

### 推荐顺序（考虑依赖关系）

**阶段 1：基础设施（并行）**
```
Task 2: 测试体系 (18-25h)
├─ 优先执行，为后续开发提供质量保障
└─ 可以在实现其他功能时同步编写测试

Task 3: 插件远程安装 (17-25h)
├─ 独立功能，可并行开发
└─ 完成后生态化能力大幅提升
```

**阶段 2：用户体验提升**
```
Task 1: /recap 命令 (7-9h)
├─ 依赖 tracking 系统（已存在）
├─ 可以利用已完成的测试体系验证
└─ 直接提升用户创作体验
```

### 如果资源有限（单人开发）

**优先顺序：**
1. **Task 1: /recap** (7-9h) - 最快见效，用户价值最高
2. **Task 2: 测试体系** (18-25h) - 长期价值最大
3. **Task 3: 插件远程安装** (17-25h) - 生态化基础

### 如果资源充足（多人协作）

**并行方案：**
- **人员 A:** Task 1 (/recap) - 1 周
- **人员 B:** Task 2 (测试体系) - 2 周
- **人员 C:** Task 3 (插件远程安装) - 2 周

---

## 📁 计划文档结构

每个计划文档包含：

### 标准章节
1. **Header** - 目标、架构、技术栈
2. **背景与动机** - 问题、价值、理论基础
3. **Task 分解** - 10 个左右的步骤，每步 1-3 小时
4. **验证标准** - 完成清单、质量标准、成功指标
5. **预估工时** - 详细的时间分配

### 特殊内容
- `/recap`: 包含完整的上下文简报模板设计
- 测试体系: 包含完整的测试目录结构和用例设计
- 插件远程安装: 包含 npm/GitHub 两种安装器的实现细节

---

## 🔗 与 P0 的关系

| | P0 任务 | P1 任务 |
|---|---------|---------|
| **性质** | 还债（PRD 承诺未实现） | 提升（核心体验增强） |
| **紧急度** | 高（影响完整性） | 中（影响体验） |
| **用户感知** | 功能缺失 | 功能不足 |
| **建议顺序** | 先完成 P0 | 再做 P1 |

**执行建议：**
1. 先完成 P0 的 7 项任务（15-20h）
2. 再开始 P1 的 3 项任务（42-59h）

**原因：**
- P0 是"还债"，必须先还清
- P0 完成后，项目功能完整性达标
- P1 可以基于完整的 P0 功能开发

---

## 📝 使用指南

### For 执行者

1. **选择任务**
   ```bash
   # 建议从 /recap 开始（最快见效）
   cat docs/p1-plans/2025-02-06-recap-command.md
   ```

2. **使用 executing-plans skill**
   ```
   I need to implement the plan in docs/p1-plans/2025-02-06-recap-command.md
   Please use superpowers:executing-plans to execute this task-by-task.
   ```

3. **逐步执行**
   - 按照 Task 1 → Task 2 → ... 顺序
   - 每个 Task 严格按照计划
   - 完成后运行验证

4. **提交时引用计划**
   ```bash
   git commit -m "feat(commands): 添加 /recap 上下文重建命令

   按照 docs/p1-plans/2025-02-06-recap-command.md 实现

   Closes: P1 优先级任务 #1"
   ```

### For 规划者

参考现有 3 个计划文档的格式，保持一致性。

---

## 🎯 进度追踪

### P1 实现进度

```
总进度: 0/3 (0%)

任务列表:
├── /recap 上下文重建命令     [ ] (0/10 tasks)
├── 测试体系                  [ ] (0/10 tasks)
└── 插件远程安装              [ ] (0/10 tasks)
```

### 完成后的效果

**✅ P1 全部完成后，项目将具备：**
- 🎯 解决长篇创作失焦问题（/recap）
- 🛡️ 完善的质量保障体系（测试）
- 🌍 开放的插件生态（远程安装）

**这将使 Novel Writer Skills 从"功能完整"（P0）进化到"体验优秀"（P1）。**

---

## 🔗 相关文档

- [P0 计划文档](../plans/README.md)
- [项目总体分析](../../README.md)
- [PRD 文档](../novel-writer-skills-prd.md)

---

## 📝 更新日志

| 日期 | 更新内容 | 作者 |
|------|---------|------|
| 2025-02-06 | 创建 P1 任务的 3 个实现计划 | Claude |

---

**计划状态：** ✅ P1 任务规划完成，等待执行

**建议执行时机：** 完成 P0 任务后

**预期收益：** 核心体验提升 + 生态化基础 + 质量保障
